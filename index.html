<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerTools RD - Versi√≥n Completa</title>
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iMTIiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcl8xXzEpIi8+CjxwYXRoIGQ9Ik0yMCAyMEg0NEwyOCAzNkgzNkw0NCA0NEgyMFYyMFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0yOCAyOEgzNkwzMiAzMkg0MEwzNiAzNkgyOFYyOFoiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjciLz4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQwX2xpbmVhcl8xXzEiIHgxPSIwIiB5MT0iMCIgeDI9IjY0IiB5Mj0iNjQiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iI0ZGNkIzNSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMyRTQwNTciLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f7; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #FF6B35, #2E4057); color: white; padding: 1.5rem; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header h1 { font-size: 2rem; margin-bottom: 0.5rem; font-weight: 600; }
        .header p { opacity: 0.9; font-size: 1.1rem; }
        .nav { display: flex; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow-x: auto; }
        .nav-btn { flex: 1; min-width: 120px; padding: 1rem; text-align: center; border: none; background: none; color: #666; font-size: 0.9rem; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s ease; }
        .nav-btn.active { color: #FF6B35; border-bottom-color: #FF6B35; background: rgba(255, 107, 53, 0.05); }
        .nav-btn:hover { background: rgba(255, 107, 53, 0.1); }
        .nav-btn i { display: block; font-size: 1.5rem; margin-bottom: 0.5rem; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background: white; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border: 1px solid #e9ecef; }
        .card h3 { color: #FF6B35; margin-bottom: 1.5rem; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: linear-gradient(135deg, #FF6B35, #F39C12); color: white; padding: 2rem; border-radius: 12px; text-align: center; box-shadow: 0 4px 20px rgba(255, 107, 53, 0.3); }
        .stat-value { font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem; }
        .stat-label { font-size: 1rem; opacity: 0.9; }
        .table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .table th, .table td { padding: 1rem; text-align: left; border-bottom: 1px solid #e9ecef; }
        .table th { background: #f8f9fa; font-weight: 600; color: #2E4057; }
        .table tr:hover { background: #f8f9fa; }
        .btn { background: #FF6B35; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; text-decoration: none; }
        .btn:hover { background: #e55a2b; transform: translateY(-1px); }
        .btn-secondary { background: #6c757d; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-warning { background: #ffc107; color: #212529; }
        .fab { position: fixed; bottom: 2rem; right: 2rem; width: 60px; height: 60px; border-radius: 50%; background: #FF6B35; color: white; border: none; font-size: 1.5rem; cursor: pointer; box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4); z-index: 1000; transition: all 0.3s ease; }
        .fab:hover { transform: scale(1.1); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 1rem; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 12px; padding: 2rem; width: 100%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .modal-header h2 { color: #FF6B35; margin: 0; }
        .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2E4057; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; transition: border-color 0.3s ease; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #FF6B35; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .badge { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .badge-success { background: rgba(40, 167, 69, 0.1); color: #28a745; }
        .badge-warning { background: rgba(255, 193, 7, 0.1); color: #ffc107; }
        .badge-danger { background: rgba(220, 53, 69, 0.1); color: #dc3545; }
        .alert { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .alert-success { background: rgba(40, 167, 69, 0.1); color: #28a745; border: 1px solid rgba(40, 167, 69, 0.2); }
        .chart-container { height: 300px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 1rem 0; }
        .action-buttons { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
        .backup-section { background: linear-gradient(135deg, #28a745, #20c997); margin-bottom: 1rem; padding: 1rem; border-radius: 8px; }
        .backup-section h4 { color: white; margin: 0 0 0.5rem 0; display: flex; align-items: center; gap: 0.5rem; }
        .backup-section p { color: rgba(255,255,255,0.9); margin: 0 0 1rem 0; font-size: 0.9rem; }
        
        /* Login Screen Styles */
        .login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #FF6B35, #2E4057); display: flex; align-items: center; justify-content: center; z-index: 3000; }
        .login-container { background: white; border-radius: 20px; padding: 3rem; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center; }
        .login-header h1 { color: #FF6B35; font-size: 2.5rem; margin-bottom: 0.5rem; }
        .login-header p { color: #666; margin-bottom: 2rem; font-size: 1.1rem; }
        .login-form h2 { color: #2E4057; margin-bottom: 2rem; font-size: 1.5rem; }
        .login-btn { width: 100%; padding: 1rem; font-size: 1.1rem; margin: 1.5rem 0; }
        .login-options { margin: 1rem 0; }
        .login-options .btn { width: 100%; margin: 0.5rem 0; }
        .login-note { color: #666; font-size: 0.9rem; margin-top: 1rem; }
        .user-info { position: absolute; top: 1.5rem; right: 2rem; display: flex; align-items: center; gap: 1rem; }
        .user-info span { color: rgba(255,255,255,0.9); font-weight: 500; }
        .admin-login { margin-bottom: 2rem; padding-bottom: 2rem; border-bottom: 1px solid #eee; }
        .admin-login h3 { color: #FF6B35; margin-bottom: 1rem; }
        
        /* Inventory Styles */
        .inventory-controls { margin-bottom: 2rem; }
        .search-filters { display: flex; gap: 1rem; margin-bottom: 1rem; align-items: center; flex-wrap: wrap; }
        .search-filters input, .search-filters select { flex: 1; min-width: 200px; }
        .view-toggle { margin-bottom: 1rem; }
        .view-toggle .btn { margin-right: 0.5rem; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
        .product-card { background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease; }
        .product-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .product-image { width: 100%; height: 200px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; overflow: hidden; }
        .product-image img { width: 100%; height: 100%; object-fit: cover; }
        .product-image .no-image { color: #ccc; font-size: 3rem; }
        .product-info h4 { color: #2E4057; margin-bottom: 0.5rem; }
        .product-code { color: #666; font-size: 0.9rem; margin-bottom: 0.5rem; }
        .product-prices { display: flex; justify-content: space-between; margin: 1rem 0; }
        .price { font-weight: bold; }
        .buy-price { color: #dc3545; }
        .sell-price { color: #28a745; }
        .stock-info { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
        .stock-badge { padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem; font-weight: 600; }
        .stock-high { background: rgba(40, 167, 69, 0.1); color: #28a745; }
        .stock-medium { background: rgba(255, 193, 7, 0.1); color: #ffc107; }
        .stock-low { background: rgba(220, 53, 69, 0.1); color: #dc3545; }
        .stock-out { background: rgba(108, 117, 125, 0.1); color: #6c757d; }
        
        /* Photo Upload Styles */
        .photo-upload-area { border: 2px dashed #ddd; border-radius: 8px; padding: 2rem; text-align: center; background: #f8f9fa; cursor: pointer; transition: all 0.3s ease; margin: 1rem 0; }
        .photo-upload-area:hover { border-color: #FF6B35; background: rgba(255, 107, 53, 0.05); }
        .photo-upload-area.dragover { border-color: #FF6B35; background: rgba(255, 107, 53, 0.1); }
        .photo-preview { display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem; }
        .photo-item { position: relative; width: 100px; height: 100px; border-radius: 8px; overflow: hidden; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; }
        .photo-remove { position: absolute; top: 4px; right: 4px; background: rgba(220, 53, 69, 0.9); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 0.8rem; cursor: pointer; }
        
        /* Mobile Optimizations */
        .search-input-container { position: relative; display: flex; align-items: center; }
        .search-input-container input { padding-right: 80px; }
        .btn-icon { position: absolute; right: 5px; background: none; border: none; color: #FF6B35; font-size: 1.1rem; padding: 0.5rem; cursor: pointer; transition: all 0.3s ease; }
        .btn-icon:hover { background: rgba(255, 107, 53, 0.1); border-radius: 50%; }
        .voice-search { right: 40px; }
        .barcode-scanner { right: 5px; }
        .voice-active { color: #dc3545; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        /* Touch-friendly improvements */
        .product-card { cursor: pointer; touch-action: manipulation; }
        .product-card:active { transform: scale(0.98); }
        .swipe-actions { display: flex; gap: 0.5rem; margin-top: 1rem; }
        .quick-action { padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem; border: none; cursor: pointer; }
        .quick-edit { background: #ffc107; color: #212529; }
        .quick-duplicate { background: #17a2b8; color: white; }
        .quick-delete { background: #dc3545; color: white; }
        
        /* Loading states */
        .loading { opacity: 0.6; pointer-events: none; }
        .loading::after { content: ''; position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; border: 2px solid #FF6B35; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        
        /* Quotation Styles */
        .form-section { margin-bottom: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #FF6B35; }
        .form-section h3 { color: #FF6B35; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .product-search-container { position: relative; }
        .product-search-results { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; border-radius: 6px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none; }
        .product-search-item { padding: 0.75rem; border-bottom: 1px solid #eee; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .product-search-item:hover { background: #f8f9fa; }
        .product-search-item:last-child { border-bottom: none; }
        .product-info { flex: 1; }
        .product-name { font-weight: 600; color: #2E4057; }
        .product-details { font-size: 0.9rem; color: #666; }
        .product-price { font-weight: bold; color: #FF6B35; }
        .quotation-products { margin-top: 1rem; }
        .empty-products { text-align: center; padding: 2rem; color: #666; background: #f8f9fa; border-radius: 8px; }
        .quotation-totals { background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #ddd; }
        .totals-grid { display: grid; gap: 0.75rem; }
        .total-item { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee; }
        .total-item:last-child { border-bottom: none; }
        .final-total { border-top: 2px solid #FF6B35; margin-top: 0.5rem; padding-top: 1rem; font-size: 1.1rem; }
        .tax-option { margin-top: 1rem; text-align: center; }
        .quantity-input { width: 80px; text-align: center; }
        .discount-input { width: 70px; text-align: center; }
        .quotation-status-pending { background: rgba(255, 193, 7, 0.1); color: #ffc107; }
        .quotation-status-approved { background: rgba(40, 167, 69, 0.1); color: #28a745; }
        .quotation-status-rejected { background: rgba(220, 53, 69, 0.1); color: #dc3545; }
        .quotation-status-expired { background: rgba(108, 117, 125, 0.1); color: #6c757d; }
        .photo-upload-area { border: 2px dashed #ddd; border-radius: 8px; padding: 1rem; text-align: center; }
        .photo-preview { cursor: pointer; }
        .photo-placeholder { padding: 2rem; color: #666; }
        .photo-placeholder i { font-size: 3rem; color: #ccc; margin-bottom: 1rem; }
        .photo-placeholder p { margin-bottom: 0.5rem; font-weight: 600; }
        .photo-placeholder small { color: #999; }
        #photoPreview { max-width: 100%; max-height: 200px; border-radius: 8px; margin-bottom: 1rem; }
        .photo-actions { margin-top: 1rem; }
        .photo-actions .btn { margin: 0 0.25rem; }
        .table .product-thumb { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; cursor: pointer; }
        .table .no-thumb { width: 50px; height: 50px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #ccc; cursor: pointer; }
        .product-link { color: #FF6B35; text-decoration: none; }
        .product-link:hover { text-decoration: underline; }
        
        /* Product Details Modal Styles */
        .product-details-modal { max-width: 900px; width: 95%; }
        .product-details-content { display: flex; flex-direction: column; gap: 2rem; }
        .product-details-main { display: grid; grid-template-columns: 300px 1fr; gap: 2rem; }
        .product-details-image { text-align: center; }
        .product-details-image img { width: 100%; max-width: 300px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .details-no-image { background: #f8f9fa; border: 2px dashed #ddd; border-radius: 12px; padding: 3rem 1rem; color: #999; }
        .details-no-image i { font-size: 4rem; margin-bottom: 1rem; }
        .detail-header h3 { color: #2E4057; margin-bottom: 0.5rem; font-size: 1.8rem; }
        .product-code-large { background: #FF6B35; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: bold; font-size: 0.9rem; }
        .detail-section { margin-bottom: 2rem; }
        .detail-section h4 { color: #FF6B35; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .detail-item { display: flex; justify-content: space-between; padding: 0.75rem; background: #f8f9fa; border-radius: 8px; }
        .detail-item label { font-weight: 600; color: #666; }
        .stock-large { font-weight: bold; font-size: 1.2rem; }
        .pricing-info { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .price-item { display: flex; justify-content: space-between; padding: 1rem; border-radius: 8px; }
        .buy-price-detail { background: rgba(220, 53, 69, 0.1); }
        .sell-price-detail { background: rgba(40, 167, 69, 0.1); }
        .profit-detail { background: rgba(255, 193, 7, 0.1); }
        .margin-detail { background: rgba(255, 107, 53, 0.1); }
        .inventory-value { display: grid; grid-template-columns: 1fr; gap: 0.5rem; }
        .value-item { display: flex; justify-content: space-between; padding: 0.75rem; border-radius: 8px; background: #f8f9fa; }
        .value-buy { color: #dc3545; font-weight: bold; }
        .value-sell { color: #28a745; font-weight: bold; }
        .value-profit { color: #FF6B35; font-weight: bold; }
        .description-text, .notes-text { background: #f8f9fa; padding: 1rem; border-radius: 8px; border-left: 4px solid #FF6B35; }
        .history-info { display: flex; gap: 1rem; }
        .history-item { flex: 1; display: flex; justify-content: space-between; padding: 0.75rem; background: #f8f9fa; border-radius: 8px; }
        .details-actions { border-top: 1px solid #eee; padding-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap; }
        
        @media (max-width: 768px) { 
            .container { padding: 1rem; }
            .header { padding: 1rem; }
            .header h1 { font-size: 1.5rem; }
            .header p { font-size: 1rem; }
            .product-details-main { grid-template-columns: 1fr; }
            .detail-grid, .pricing-info { grid-template-columns: 1fr; }
            .history-info { flex-direction: column; }
            .stats-grid { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
            .table { font-size: 0.9rem; }
            .nav-btn { min-width: 70px; font-size: 0.8rem; padding: 0.75rem 0.25rem; }
            .nav-btn i { font-size: 1.2rem; }
            .card { padding: 1rem; margin-bottom: 1rem; }
            .search-filters { flex-direction: column; gap: 0.75rem; }
            .search-filters input, .search-filters select { min-width: 100%; }
            .action-buttons { justify-content: space-between; }
            .action-buttons .btn { flex: 1; margin: 0.25rem; padding: 0.5rem; font-size: 0.8rem; }
            .products-grid { grid-template-columns: 1fr; gap: 1rem; }
            .product-card { padding: 1rem; }
            .product-image { height: 150px; }
            .modal-content { padding: 1rem; margin: 0.5rem; }
            .fab { bottom: 1rem; right: 1rem; width: 50px; height: 50px; font-size: 1.2rem; }
            .table th, .table td { padding: 0.5rem; font-size: 0.8rem; }
            .stat-card { padding: 1.5rem; }
            .stat-value { font-size: 2rem; }
            .backup-section { padding: 0.75rem; }
            .backup-section h4 { font-size: 1rem; }
            .user-info { position: static; background: rgba(0,0,0,0.1); padding: 0.5rem; border-radius: 8px; margin-bottom: 1rem; }
            .inventory-controls { margin-bottom: 1rem; }
            .view-toggle { margin-bottom: 0.5rem; }
            .view-toggle .btn { padding: 0.5rem 1rem; margin-right: 0.25rem; }
        }
        
        @media (max-width: 480px) {
            .container { padding: 0.5rem; }
            .nav { flex-wrap: wrap; }
            .nav-btn { min-width: 50px; font-size: 0.7rem; padding: 0.5rem 0.25rem; }
            .header h1 { font-size: 1.2rem; }
            .action-buttons .btn { padding: 0.4rem; font-size: 0.7rem; }
            .products-grid { gap: 0.5rem; }
            .modal-content { margin: 0.25rem; }
            .btn-text { display: none; } /* Ocultar texto en botones muy peque√±os */
        }
        
        /* Estilos espec√≠ficos para dispositivos m√≥viles */
        .mobile-device .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .mobile-device .action-buttons { justify-content: space-around; }
        .mobile-device .search-filters { gap: 0.5rem; }
        .mobile-device .fab { box-shadow: 0 4px 15px rgba(255, 107, 53, 0.6); }
        .mobile-device .modal-content { max-height: 95vh; }
        .mobile-device .product-card { box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .mobile-device .nav-btn { border-radius: 0; }
        .mobile-device .nav-btn.active { border-radius: 8px 8px 0 0; }
        
        /* Estados de carga optimizados para m√≥vil */
        .mobile-device .loading { position: relative; }
        .mobile-device .loading::after { width: 16px; height: 16px; border-width: 1px; }
        
        /* Mejoras de accesibilidad para touch */
        .mobile-device .btn { min-height: 44px; min-width: 44px; }
        .mobile-device .btn-icon { min-width: 40px; min-height: 40px; }
        .mobile-device .table th, .mobile-device .table td { padding: 0.75rem 0.5rem; }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fas fa-tools"></i> PowerTools RD</h1>
                <p>Sistema Completo de Gesti√≥n Empresarial</p>
            </div>
            <div class="login-form">
                <h2>Iniciar Sesi√≥n en PowerTools</h2>
                <div class="form-group">
                    <label for="loginUsername">Nombre de Usuario</label>
                    <input type="text" id="loginUsername" placeholder="Ingresa tu usuario" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Contrase√±a</label>
                    <input type="password" id="loginPassword" placeholder="Ingresa tu contrase√±a" required>
                </div>
                <button class="btn login-btn" onclick="authenticateUser()">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n
                </button>
                <div class="login-options">
                    <button type="button" class="btn btn-secondary" onclick="showAdminPanel()">
                        <i class="fas fa-user-cog"></i> Panel de Administrador
                    </button>
                </div>
                <p class="login-note">
                    <i class="fas fa-shield-alt"></i> 
                    Acceso restringido - Solo usuarios autorizados
                </p>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminPanel" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-cog"></i> Panel de Administrador</h2>
                <button class="close-btn" onclick="closeModal('adminPanel')">&times;</button>
            </div>
            <div class="admin-login">
                <h3>Acceso de Administrador</h3>
                <div class="form-group">
                    <label for="adminPassword">Contrase√±a de Administrador</label>
                    <input type="password" id="adminPassword" placeholder="Contrase√±a maestra" required>
                </div>
                <button class="btn" onclick="validateAdmin()">
                    <i class="fas fa-unlock"></i> Acceder
                </button>
            </div>
            <div id="adminControls" style="display: none;">
                <h3>Gesti√≥n de Usuarios</h3>
                <div class="action-buttons">
                    <button class="btn" onclick="showCreateUserForm()">
                        <i class="fas fa-user-plus"></i> Crear Usuario
                    </button>
                    <button class="btn btn-secondary" onclick="exportUserCredentials()">
                        <i class="fas fa-download"></i> Exportar Usuarios
                    </button>
                </div>
                
                <div id="createUserForm" style="display: none;">
                    <h4>Crear Nuevo Usuario</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Completo</label>
                            <input type="text" id="newUserFullName" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre de Usuario</label>
                            <input type="text" id="newUsername" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Contrase√±a</label>
                            <input type="password" id="newPassword" required>
                        </div>
                        <div class="form-group">
                            <label>Rol</label>
                            <select id="newUserRole" required>
                                <option value="">Seleccionar...</option>
                                <option value="Propietario">Propietario</option>
                                <option value="Gerente">Gerente</option>
                                <option value="Vendedor">Vendedor</option>
                                <option value="Empleado">Empleado</option>
                                <option value="Cliente">Cliente</option>
                            </select>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn" onclick="createNewUser()">
                            <i class="fas fa-save"></i> Crear Usuario
                        </button>
                        <button class="btn btn-secondary" onclick="cancelCreateUser()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Usuario</th>
                            <th>Rol</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="credentialsTable">
                        <!-- Los usuarios se llenan din√°micamente -->
                    </tbody>
                </table>
            </div>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden initially) -->
    <div id="mainApp" class="main-app" style="display: none;">
        <div class="header">
            <h1><i class="fas fa-tools"></i> PowerTools RD</h1>
            <p>Sistema Completo de Gesti√≥n Empresarial</p>
            <div class="user-info">
                <span id="welcomeMessage">Bienvenido, Usuario</span>
                <button class="btn btn-secondary" onclick="logoutUser()">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>

    <div class="nav">
        <button class="nav-btn active" onclick="showSection('dashboard')">
            <i class="fas fa-chart-line"></i>
            Dashboard
        </button>
        <button class="nav-btn" onclick="showSection('users')">
            <i class="fas fa-users"></i>
            Usuarios
        </button>
        <button class="nav-btn" onclick="showSection('quotations')">
            <i class="fas fa-file-invoice"></i>
            Cotizaciones
        </button>
        <button class="nav-btn" onclick="showSection('inventory')">
            <i class="fas fa-boxes"></i>
            Inventario
        </button>
        <button class="nav-btn" onclick="showSection('expenses')">
            <i class="fas fa-money-bill-wave"></i>
            Gastos
        </button>
        <button class="nav-btn" onclick="showSection('sales')">
            <i class="fas fa-cash-register"></i>
            Ventas
        </button>
        <button class="nav-btn" onclick="showSection('reports')">
            <i class="fas fa-chart-bar"></i>
            Reportes
        </button>
    </div>

    <div class="container">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">4</div>
                    <div class="stat-label">Usuarios Activos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">12</div>
                    <div class="stat-label">Cotizaciones</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">85</div>
                    <div class="stat-label">Productos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">$24,500</div>
                    <div class="stat-label">Ventas del Mes</div>
                </div>
            </div>

            <div class="card">
                <h3><i class="fas fa-tachometer-alt"></i> Resumen Ejecutivo</h3>
                <div class="chart-container">
                    <p><i class="fas fa-chart-line" style="font-size: 3rem; color: #FF6B35;"></i><br>Gr√°fico de Ventas Mensuales</p>
                </div>
                <div class="action-buttons">
                    <button class="btn" onclick="generateReport()">
                        <i class="fas fa-file-pdf"></i> Generar Reporte
                    </button>
                    <button class="btn btn-secondary" onclick="exportData()">
                        <i class="fas fa-download"></i> Exportar Datos
                    </button>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="users" class="section">
            <div class="card">
                <h3><i class="fas fa-users"></i> Gesti√≥n de Usuarios</h3>
                
                <!-- Backup Information -->
                <div class="backup-section">
                    <h4><i class="fas fa-shield-alt"></i> Sistema de Respaldo de Datos</h4>
                    <p>Utiliza estas herramientas para respaldar y restaurar toda tu informaci√≥n de PowerTools. Recomendamos hacer respaldos antes de cualquier actualizaci√≥n importante.</p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn" onclick="showModal('userModal')">
                        <i class="fas fa-plus"></i> Nuevo Usuario
                    </button>
                    <button class="btn btn-success" onclick="createBackupWithVerification()">
                        <i class="fas fa-download"></i> Respaldar Datos
                    </button>
                    <button class="btn btn-warning" onclick="importAllData()">
                        <i class="fas fa-upload"></i> Restaurar Datos
                    </button>
                    <button class="btn btn-secondary" onclick="exportUsers()">
                        <i class="fas fa-file-excel"></i> Exportar Usuarios
                    </button>
                </div>
                <table class="table" id="usersTable">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th>Estado</th>
                            <th>√öltimo Acceso</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Admin Principal</td>
                            <td>admin@powertools.com</td>
                            <td>Administrador</td>
                            <td><span class="badge badge-success">Activo</span></td>
                            <td>10/08/2025 14:30</td>
                            <td>
                                <button class="btn btn-warning" onclick="editUser(1)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deleteUser(1)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>Carlos Manager</td>
                            <td>carlos@powertools.com</td>
                            <td>Gerente</td>
                            <td><span class="badge badge-success">Activo</span></td>
                            <td>10/08/2025 12:15</td>
                            <td>
                                <button class="btn btn-warning" onclick="editUser(2)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deleteUser(2)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Quotations Section -->
        <div id="quotations" class="section">
            <div class="card">
                <h3><i class="fas fa-file-invoice"></i> Gesti√≥n de Cotizaciones</h3>
                <div class="action-buttons">
                    <button class="btn" onclick="showModal('quotationModal')">
                        <i class="fas fa-plus"></i> Nueva Cotizaci√≥n
                    </button>
                    <button class="btn btn-secondary" onclick="exportQuotations()">
                        <i class="fas fa-file-pdf"></i> Exportar PDF
                    </button>
                </div>
                <table class="table" id="quotationsTable">
                    <thead>
                        <tr>
                            <th>N√∫mero</th>
                            <th>Cliente</th>
                            <th>Fecha</th>
                            <th>Total</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="quotationsTableBody">
                        <!-- Las cotizaciones se cargan din√°micamente -->
                    </tbody>
                </table>
                
                <div id="emptyQuotations" class="empty-products" style="display: none;">
                    <p><i class="fas fa-info-circle"></i> No hay cotizaciones creadas. Crea tu primera cotizaci√≥n usando el bot√≥n "Nueva Cotizaci√≥n".</p>
                </div>
            </div>
        </div>

        <!-- Inventory Section -->
        <div id="inventory" class="section">
            <div class="card">
                <h3><i class="fas fa-boxes"></i> Gesti√≥n de Inventario</h3>
                
                <!-- Filtros y b√∫squeda -->
                <div class="inventory-controls">
                    <div class="search-filters">
                        <div class="search-input-container">
                            <input type="text" id="productSearch" placeholder="Buscar productos..." onkeyup="filterProducts()">
                            <button class="btn-icon voice-search" onclick="startVoiceSearch()" title="B√∫squeda por voz">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="btn-icon barcode-scanner" onclick="startBarcodeScanner()" title="Escanear c√≥digo">
                                <i class="fas fa-qrcode"></i>
                            </button>
                        </div>
                        <select id="categoryFilter" onchange="filterProducts()">
                            <option value="">Todas las categor√≠as</option>
                            <option value="Herramientas El√©ctricas">Herramientas El√©ctricas</option>
                            <option value="Herramientas Manuales">Herramientas Manuales</option>
                            <option value="Construcci√≥n">Construcci√≥n</option>
                            <option value="Jardiner√≠a">Jardiner√≠a</option>
                            <option value="Automotriz">Automotriz</option>
                            <option value="Accesorios">Accesorios</option>
                        </select>
                        <select id="stockFilter" onchange="filterProducts()">
                            <option value="">Todo el stock</option>
                            <option value="low">Stock bajo (< 5)</option>
                            <option value="medium">Stock medio (5-20)</option>
                            <option value="high">Stock alto (> 20)</option>
                            <option value="out">Agotado</option>
                        </select>
                    </div>
                    <div class="action-buttons">
                        <button class="btn" onclick="showModal('productModal')">
                            <i class="fas fa-plus"></i> <span class="btn-text">Agregar</span>
                        </button>
                        <button class="btn btn-secondary" onclick="generateInventoryReport()">
                            <i class="fas fa-clipboard-list"></i> <span class="btn-text">Reporte</span>
                        </button>
                        <button class="btn btn-warning" onclick="showLowStockAlert()">
                            <i class="fas fa-exclamation-triangle"></i> <span class="btn-text">Stock Bajo</span>
                        </button>
                        <button class="btn btn-success" onclick="bulkActions()">
                            <i class="fas fa-tasks"></i> <span class="btn-text">Acciones</span>
                        </button>
                    </div>
                </div>

                <!-- Vista de productos -->
                <div class="inventory-view">
                    <div class="view-toggle">
                        <button class="btn btn-secondary" onclick="toggleView('grid')" id="gridViewBtn">
                            <i class="fas fa-th"></i> Vista Cuadr√≠cula
                        </button>
                        <button class="btn btn-secondary active" onclick="toggleView('table')" id="tableViewBtn">
                            <i class="fas fa-list"></i> Vista Tabla
                        </button>
                    </div>

                    <!-- Vista en tabla -->
                    <div id="tableView" class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Foto</th>
                                    <th>C√≥digo</th>
                                    <th>Producto</th>
                                    <th>Categor√≠a</th>
                                    <th>Stock</th>
                                    <th>Precio Compra</th>
                                    <th>Precio Venta</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <!-- Los productos se llenan din√°micamente -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Vista en cuadr√≠cula -->
                    <div id="gridView" class="products-grid" style="display: none;">
                        <!-- Los productos se llenan din√°micamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Expenses Section -->
        <div id="expenses" class="section">
            <div class="card">
                <h3><i class="fas fa-money-bill-wave"></i> Control de Gastos</h3>
                <div class="action-buttons">
                    <button class="btn" onclick="showModal('expenseModal')">
                        <i class="fas fa-plus"></i> Nuevo Gasto
                    </button>
                    <button class="btn btn-secondary" onclick="exportExpenses()">
                        <i class="fas fa-file-excel"></i> Exportar
                    </button>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Descripci√≥n</th>
                            <th>Categor√≠a</th>
                            <th>Monto</th>
                            <th>Proveedor</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>10/08/2025</td>
                            <td>Combustible</td>
                            <td>Transporte</td>
                            <td>$45.00</td>
                            <td>Estaci√≥n Shell</td>
                            <td>
                                <button class="btn btn-warning" onclick="editExpense(1)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deleteExpense(1)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Sales Section -->
        <div id="sales" class="section">
            <div class="card">
                <h3><i class="fas fa-cash-register"></i> Gesti√≥n de Ventas</h3>
                <div class="action-buttons">
                    <button class="btn" onclick="showModal('saleModal')">
                        <i class="fas fa-plus"></i> Nueva Venta
                    </button>
                    <button class="btn btn-secondary" onclick="generateSalesReport()">
                        <i class="fas fa-chart-line"></i> Reporte Ventas
                    </button>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Factura</th>
                            <th>Cliente</th>
                            <th>Fecha</th>
                            <th>Total</th>
                            <th>M√©todo Pago</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>FAC-001</td>
                            <td>Juan P√©rez</td>
                            <td>10/08/2025</td>
                            <td>$340.00</td>
                            <td>Efectivo</td>
                            <td><span class="badge badge-success">Pagado</span></td>
                            <td>
                                <button class="btn" onclick="printInvoice(1)">
                                    <i class="fas fa-print"></i>
                                </button>
                                <button class="btn btn-secondary" onclick="sendInvoice(1)">
                                    <i class="fas fa-envelope"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section">
            <div class="card">
                <h3><i class="fas fa-chart-bar"></i> Reportes y An√°lisis</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">$45,230</div>
                        <div class="stat-label">Ingresos Totales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">$8,450</div>
                        <div class="stat-label">Gastos Totales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">$36,780</div>
                        <div class="stat-label">Ganancia Neta</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">18.7%</div>
                        <div class="stat-label">Margen de Ganancia</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn" onclick="generateReport('monthly')">
                        <i class="fas fa-calendar-alt"></i> Reporte Mensual
                    </button>
                    <button class="btn" onclick="generateReport('yearly')">
                        <i class="fas fa-calendar"></i> Reporte Anual
                    </button>
                    <button class="btn btn-secondary" onclick="exportAllData()">
                        <i class="fas fa-database"></i> Exportar Todo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quotation Modal -->
    <div id="quotationModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2><i class="fas fa-file-invoice"></i> <span id="quotationModalTitle">Nueva Cotizaci√≥n</span></h2>
                <button class="close-btn" onclick="closeModal('quotationModal')">&times;</button>
            </div>
            <form onsubmit="saveQuotation(event)" id="quotationForm">
                <!-- Informaci√≥n del Cliente -->
                <div class="form-section">
                    <h3><i class="fas fa-user"></i> Informaci√≥n del Cliente</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientName">Nombre del Cliente *</label>
                            <input type="text" id="clientName" required>
                        </div>
                        <div class="form-group">
                            <label for="clientEmail">Email</label>
                            <input type="email" id="clientEmail">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientPhone">Tel√©fono</label>
                            <input type="tel" id="clientPhone">
                        </div>
                        <div class="form-group">
                            <label for="clientCompany">Empresa</label>
                            <input type="text" id="clientCompany">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="clientAddress">Direcci√≥n</label>
                        <textarea id="clientAddress" rows="2"></textarea>
                    </div>
                </div>

                <!-- Informaci√≥n de la Cotizaci√≥n -->
                <div class="form-section">
                    <h3><i class="fas fa-file-alt"></i> Detalles de la Cotizaci√≥n</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quotationNumber">N√∫mero de Cotizaci√≥n</label>
                            <input type="text" id="quotationNumber" readonly>
                        </div>
                        <div class="form-group">
                            <label for="quotationDate">Fecha</label>
                            <input type="date" id="quotationDate">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="validUntil">V√°lida Hasta</label>
                            <input type="date" id="validUntil">
                        </div>
                        <div class="form-group">
                            <label for="paymentTerms">T√©rminos de Pago</label>
                            <select id="paymentTerms">
                                <option value="inmediato">Pago Inmediato</option>
                                <option value="15dias">15 d√≠as</option>
                                <option value="30dias">30 d√≠as</option>
                                <option value="45dias">45 d√≠as</option>
                                <option value="60dias">60 d√≠as</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="quotationNotes">Notas / Condiciones</label>
                        <textarea id="quotationNotes" rows="2" placeholder="Condiciones especiales, garant√≠as, etc."></textarea>
                    </div>
                </div>

                <!-- Productos -->
                <div class="form-section">
                    <h3><i class="fas fa-boxes"></i> Productos</h3>
                    <div class="product-search-section">
                        <div class="form-group">
                            <label for="productSearch">Buscar Producto</label>
                            <div class="product-search-container">
                                <input type="text" id="productSearchQuotation" placeholder="Buscar producto por nombre o c√≥digo..." oninput="searchProductsForQuotation()">
                                <div id="productSearchResults" class="product-search-results"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quotation-products">
                        <table class="table" id="quotationProductsTable">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>C√≥digo</th>
                                    <th>Cantidad</th>
                                    <th>Precio Unit.</th>
                                    <th>Descuento %</th>
                                    <th>Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="quotationProductsBody">
                                <!-- Los productos se agregan din√°micamente -->
                            </tbody>
                        </table>
                        
                        <div class="empty-products" id="emptyProducts">
                            <p><i class="fas fa-info-circle"></i> No hay productos agregados. Busca y selecciona productos arriba.</p>
                        </div>
                    </div>
                </div>

                <!-- Totales -->
                <div class="form-section">
                    <div class="quotation-totals">
                        <div class="totals-grid">
                            <div class="total-item">
                                <span>Subtotal:</span>
                                <span id="quotationSubtotal">$0.00</span>
                            </div>
                            <div class="total-item">
                                <span>Descuento:</span>
                                <span id="quotationDiscount">$0.00</span>
                            </div>
                            <div class="total-item">
                                <span>ITBIS (18%):</span>
                                <span id="quotationTax">$0.00</span>
                            </div>
                            <div class="total-item final-total">
                                <span><strong>Total:</strong></span>
                                <span id="quotationTotal"><strong>$0.00</strong></span>
                            </div>
                        </div>
                        <div class="tax-option">
                            <label>
                                <input type="checkbox" id="includeTax" onchange="calculateQuotationTotals()"> Incluir ITBIS (18%)
                            </label>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> <span id="saveQuotationButtonText">Guardar Cotizaci√≥n</span>
                    </button>
                    <button type="button" class="btn btn-success" onclick="previewQuotation()">
                        <i class="fas fa-eye"></i> Vista Previa
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('quotationModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- FAB Button -->
    <button class="fab" onclick="showContextualActions()" id="contextualFab">
        <i class="fas fa-plus"></i>
    </button>

    <!-- User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nuevo Usuario</h2>
                <button class="close-btn" onclick="closeModal('userModal')">&times;</button>
            </div>
            <form onsubmit="saveUser(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre Completo</label>
                        <input type="text" id="userName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="userEmail" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Rol</label>
                        <select id="userRole" required>
                            <option value="">Seleccionar...</option>
                            <option value="admin">Administrador</option>
                            <option value="manager">Gerente</option>
                            <option value="employee">Empleado</option>
                            <option value="viewer">Visualizador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tel√©fono</label>
                        <input type="tel" id="userPhone">
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Guardar Usuario
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('userModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-box"></i> <span id="productModalTitle">Agregar Producto</span></h2>
                <button class="close-btn" onclick="closeModal('productModal')">&times;</button>
            </div>
            <form onsubmit="saveProduct(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>C√≥digo del Producto</label>
                        <input type="text" id="productCode" required placeholder="Ej: PROD-001">
                    </div>
                    <div class="form-group">
                        <label>Nombre del Producto</label>
                        <input type="text" id="productName" required placeholder="Ej: Taladro Bosch">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="productDescription" rows="3" placeholder="Describe las caracter√≠sticas del producto..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Categor√≠a</label>
                        <select id="productCategory" required>
                            <option value="">Seleccionar categor√≠a...</option>
                            <option value="Herramientas El√©ctricas">Herramientas El√©ctricas</option>
                            <option value="Herramientas Manuales">Herramientas Manuales</option>
                            <option value="Construcci√≥n">Construcci√≥n</option>
                            <option value="Jardiner√≠a">Jardiner√≠a</option>
                            <option value="Automotriz">Automotriz</option>
                            <option value="Accesorios">Accesorios</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Marca</label>
                        <input type="text" id="productBrand" placeholder="Ej: Bosch, Makita, DeWalt">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Stock Inicial</label>
                        <input type="number" id="productStock" required min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Stock M√≠nimo</label>
                        <input type="number" id="productMinStock" required min="1" value="5" placeholder="Alerta cuando sea menor a...">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Precio de Compra (US$)</label>
                        <input type="number" id="productBuyPrice" required min="0" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Precio de Venta (US$)</label>
                        <input type="number" id="productSellPrice" required min="0" step="0.01" placeholder="0.00">
                    </div>
                </div>

                <!-- Secci√≥n de foto -->
                <div class="form-group">
                    <label><i class="fas fa-camera"></i> Foto del Producto</label>
                    <div class="photo-upload-area">
                        <input type="file" id="productPhoto" accept="image/*" onchange="previewProductPhoto()" style="display: none;">
                        <div class="photo-preview" onclick="document.getElementById('productPhoto').click()">
                            <img id="photoPreview" src="" alt="" style="display: none;">
                            <div id="photoPlaceholder" class="photo-placeholder">
                                <i class="fas fa-camera-retro"></i>
                                <p>Haz clic para agregar foto</p>
                                <small>JPG, PNG, m√°x. 5MB</small>
                            </div>
                        </div>
                        <div class="photo-actions" id="photoActions" style="display: none;">
                            <button type="button" class="btn btn-secondary" onclick="removeProductPhoto()">
                                <i class="fas fa-trash"></i> Eliminar Foto
                            </button>
                            <button type="button" class="btn btn-warning" onclick="document.getElementById('productPhoto').click()">
                                <i class="fas fa-sync"></i> Cambiar Foto
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Notas Adicionales</label>
                    <textarea id="productNotes" rows="2" placeholder="Informaci√≥n adicional, proveedor, garant√≠a, etc."></textarea>
                </div>

                <div class="action-buttons">
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> <span id="saveButtonText">Guardar Producto</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('productModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div id="productDetailsModal" class="modal">
        <div class="modal-content product-details-modal">
            <div class="modal-header">
                <h2><i class="fas fa-info-circle"></i> Detalles del Producto</h2>
                <button class="close-btn" onclick="closeModal('productDetailsModal')">&times;</button>
            </div>
            
            <div class="product-details-content">
                <div class="product-details-main">
                    <div class="product-details-image">
                        <img id="detailsImage" src="" alt="" style="display: none;">
                        <div id="detailsNoImage" class="details-no-image">
                            <i class="fas fa-image"></i>
                            <p>Sin foto disponible</p>
                        </div>
                    </div>
                    
                    <div class="product-details-info">
                        <div class="detail-header">
                            <h3 id="detailsName">Nombre del Producto</h3>
                            <span id="detailsCode" class="product-code-large">C√ìDIGO</span>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-info"></i> Informaci√≥n General</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <label>Marca:</label>
                                    <span id="detailsBrand">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Categor√≠a:</label>
                                    <span id="detailsCategory">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Stock Actual:</label>
                                    <span id="detailsStock" class="stock-large">0</span>
                                </div>
                                <div class="detail-item">
                                    <label>Stock M√≠nimo:</label>
                                    <span id="detailsMinStock">0</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-dollar-sign"></i> Precios y Rentabilidad</h4>
                            <div class="pricing-info">
                                <div class="price-item buy-price-detail">
                                    <label>Precio de Compra:</label>
                                    <span id="detailsBuyPrice">$0.00</span>
                                </div>
                                <div class="price-item sell-price-detail">
                                    <label>Precio de Venta:</label>
                                    <span id="detailsSellPrice">$0.00</span>
                                </div>
                                <div class="price-item profit-detail">
                                    <label>Ganancia por Unidad:</label>
                                    <span id="detailsProfit">$0.00</span>
                                </div>
                                <div class="price-item margin-detail">
                                    <label>Margen de Ganancia:</label>
                                    <span id="detailsMargin">0%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-chart-line"></i> Valor del Inventario</h4>
                            <div class="inventory-value">
                                <div class="value-item">
                                    <label>Valor de Compra Total:</label>
                                    <span id="detailsTotalBuyValue" class="value-buy">$0.00</span>
                                </div>
                                <div class="value-item">
                                    <label>Valor de Venta Total:</label>
                                    <span id="detailsTotalSellValue" class="value-sell">$0.00</span>
                                </div>
                                <div class="value-item">
                                    <label>Ganancia Potencial:</label>
                                    <span id="detailsPotentialProfit" class="value-profit">$0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="product-details-secondary">
                    <div class="detail-section">
                        <h4><i class="fas fa-align-left"></i> Descripci√≥n</h4>
                        <p id="detailsDescription" class="description-text">Sin descripci√≥n disponible</p>
                    </div>
                    
                    <div class="detail-section">
                        <h4><i class="fas fa-sticky-note"></i> Notas Adicionales</h4>
                        <p id="detailsNotes" class="notes-text">Sin notas adicionales</p>
                    </div>
                    
                    <div class="detail-section">
                        <h4><i class="fas fa-history"></i> Historial</h4>
                        <div class="history-info">
                            <div class="history-item">
                                <label>Fecha de Creaci√≥n:</label>
                                <span id="detailsCreatedDate">-</span>
                            </div>
                            <div class="history-item">
                                <label>√öltima Actualizaci√≥n:</label>
                                <span id="detailsLastUpdated">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="details-actions">
                    <button class="btn btn-warning" onclick="editProductFromDetails()">
                        <i class="fas fa-edit"></i> Editar Producto
                    </button>
                    <button class="btn btn-success" onclick="adjustStockFromDetails()">
                        <i class="fas fa-boxes"></i> Ajustar Stock
                    </button>
                    <button class="btn btn-info" onclick="duplicateProduct()">
                        <i class="fas fa-copy"></i> Duplicar Producto
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal('productDetailsModal')">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Close Main App Container -->
    </div>

    <script>
        // Variables globales
        let currentUser = null;
        let users = [
            { id: 1, name: 'Admin Principal', email: 'admin@powertools.com', role: 'admin', status: 'active', lastAccess: '10/08/2025 14:30' },
            { id: 2, name: 'Carlos Manager', email: 'carlos@powertools.com', role: 'manager', status: 'active', lastAccess: '10/08/2025 12:15' }
        ];
        
        // Sistema de credenciales seguro
        let userCredentials = [
            { id: 1, fullName: 'Genesis Ortiz', username: 'genesis', password: 'admin123', role: 'Propietario', status: 'active', createdDate: '2025-08-16' },
            { id: 2, fullName: 'PowerTools Admin', username: 'admin', password: 'powertools2025', role: 'Gerente', status: 'active', createdDate: '2025-08-16' }
        ];
        
        const ADMIN_PASSWORD = 'powertools_master_2025'; // Contrase√±a maestra para crear usuarios

        // Sistema de inventario
        let products = [
            {
                id: 1,
                code: 'PROD-001',
                name: 'Taladro Inal√°mbrico Bosch',
                description: 'Taladro profesional de 18V con bater√≠a de litio incluida',
                category: 'Herramientas El√©ctricas',
                brand: 'Bosch',
                stock: 15,
                minStock: 5,
                buyPrice: 85.00,
                sellPrice: 125.00,
                photo: null,
                notes: 'Incluye malet√≠n y cargador',
                createdDate: '2025-08-16',
                lastUpdated: '2025-08-16'
            },
            {
                id: 2,
                code: 'PROD-002',
                name: 'Martillo de Carpintero',
                description: 'Martillo profesional con mango de fibra de vidrio',
                category: 'Herramientas Manuales',
                brand: 'Stanley',
                stock: 8,
                minStock: 3,
                buyPrice: 12.50,
                sellPrice: 18.00,
                photo: null,
                notes: 'Peso: 450g',
                createdDate: '2025-08-16',
                lastUpdated: '2025-08-16'
            },
            {
                id: 3,
                code: 'PROD-003',
                name: 'Sierra Circular Makita',
                description: 'Sierra circular de 7-1/4" para cortes precisos',
                category: 'Herramientas El√©ctricas',
                brand: 'Makita',
                stock: 3,
                minStock: 2,
                buyPrice: 150.00,
                sellPrice: 220.00,
                photo: null,
                notes: 'Potencia: 1800W',
                createdDate: '2025-08-16',
                lastUpdated: '2025-08-16'
            }
        ];
        
        let editingProductId = null;

        // Sistema de Autenticaci√≥n
        function authenticateUser() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!username || !password) {
                showAlert('Por favor, completa todos los campos', 'error');
                return;
            }
            
            // Buscar usuario en las credenciales
            const userCred = userCredentials.find(u => 
                u.username.toLowerCase() === username.toLowerCase() && 
                u.password === password &&
                u.status === 'active'
            );
            
            if (userCred) {
                // Crear sesi√≥n de usuario
                currentUser = {
                    id: userCred.id,
                    name: userCred.fullName,
                    username: userCred.username,
                    role: userCred.role,
                    lastAccess: new Date().toLocaleString('es-DO')
                };
                
                // Actualizar registro de acceso
                userCred.lastAccess = currentUser.lastAccess;
                
                // Guardar en localStorage
                localStorage.setItem('powertools_current_user', JSON.stringify(currentUser));
                localStorage.setItem('powertools_credentials', JSON.stringify(userCredentials));
                
                showMainApp();
                showAlert(`Bienvenido, ${currentUser.name}`, 'success');
            } else {
                showAlert('Usuario o contrase√±a incorrectos', 'error');
                document.getElementById('loginPassword').value = '';
            }
        }
        
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Personalizar saludo
            const welcomeMsg = document.getElementById('welcomeMessage');
            welcomeMsg.textContent = `Bienvenido, ${currentUser.name} (${currentUser.role})`;
            
            // Actualizar tabla de usuarios
            updateUsersTable();
            
            console.log(`üë§ Usuario autenticado: ${currentUser.name} (${currentUser.username})`);
        }
        
        function logoutUser() {
            if (confirm('¬øEst√°s seguro que deseas cerrar sesi√≥n?')) {
                currentUser = null;
                localStorage.removeItem('powertools_current_user');
                
                // Mostrar pantalla de login
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                
                // Limpiar formulario
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                
                console.log('üëã Sesi√≥n cerrada');
            }
        }
        
        function checkExistingLogin() {
            const savedUser = localStorage.getItem('powertools_current_user');
            const savedCredentials = localStorage.getItem('powertools_credentials');
            
            if (savedCredentials) {
                userCredentials = JSON.parse(savedCredentials);
            }
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }
        }

        // Panel de Administraci√≥n
        function showAdminPanel() {
            document.getElementById('adminPanel').classList.add('active');
        }
        
        function validateAdmin() {
            const adminPass = document.getElementById('adminPassword').value;
            
            if (adminPass === ADMIN_PASSWORD) {
                document.querySelector('.admin-login').style.display = 'none';
                document.getElementById('adminControls').style.display = 'block';
                updateCredentialsTable();
                showAlert('Acceso de administrador concedido', 'success');
            } else {
                showAlert('Contrase√±a de administrador incorrecta', 'error');
                document.getElementById('adminPassword').value = '';
            }
        }
        
        function showCreateUserForm() {
            document.getElementById('createUserForm').style.display = 'block';
        }
        
        function cancelCreateUser() {
            document.getElementById('createUserForm').style.display = 'none';
            clearCreateUserForm();
        }
        
        function clearCreateUserForm() {
            document.getElementById('newUserFullName').value = '';
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('newUserRole').value = '';
        }
        
        function createNewUser() {
            const fullName = document.getElementById('newUserFullName').value.trim();
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value.trim();
            const role = document.getElementById('newUserRole').value;
            
            if (!fullName || !username || !password || !role) {
                showAlert('Por favor, completa todos los campos', 'error');
                return;
            }
            
            // Verificar que el username no exista
            if (userCredentials.find(u => u.username.toLowerCase() === username.toLowerCase())) {
                showAlert('El nombre de usuario ya existe', 'error');
                return;
            }
            
            // Crear nuevo usuario
            const newUser = {
                id: userCredentials.length + 1,
                fullName: fullName,
                username: username,
                password: password,
                role: role,
                status: 'active',
                createdDate: new Date().toLocaleDateString('es-DO'),
                lastAccess: 'Nunca'
            };
            
            userCredentials.push(newUser);
            localStorage.setItem('powertools_credentials', JSON.stringify(userCredentials));
            
            updateCredentialsTable();
            cancelCreateUser();
            showAlert(`Usuario "${username}" creado exitosamente`, 'success');
        }
        
        function updateCredentialsTable() {
            const tbody = document.getElementById('credentialsTable');
            tbody.innerHTML = '';
            
            userCredentials.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.fullName}</td>
                    <td>${user.username}</td>
                    <td>${user.role}</td>
                    <td><span class="badge badge-${user.status === 'active' ? 'success' : 'danger'}">${user.status === 'active' ? 'Activo' : 'Inactivo'}</span></td>
                    <td>
                        <button class="btn btn-warning" onclick="toggleUserStatus(${user.id})">
                            <i class="fas fa-${user.status === 'active' ? 'lock' : 'unlock'}"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteUserCredential(${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function toggleUserStatus(userId) {
            const user = userCredentials.find(u => u.id === userId);
            if (user) {
                user.status = user.status === 'active' ? 'inactive' : 'active';
                localStorage.setItem('powertools_credentials', JSON.stringify(userCredentials));
                updateCredentialsTable();
                showAlert(`Usuario ${user.status === 'active' ? 'activado' : 'desactivado'}`, 'success');
            }
        }
        
        function deleteUserCredential(userId) {
            if (confirm('¬øEst√°s seguro que deseas eliminar este usuario?')) {
                userCredentials = userCredentials.filter(u => u.id !== userId);
                localStorage.setItem('powertools_credentials', JSON.stringify(userCredentials));
                updateCredentialsTable();
                showAlert('Usuario eliminado exitosamente', 'success');
            }
        }
        
        function exportUserCredentials() {
            const data = userCredentials.map(u => ({
                'Nombre Completo': u.fullName,
                'Usuario': u.username,
                'Contrase√±a': u.password,
                'Rol': u.role,
                'Estado': u.status,
                'Fecha Creaci√≥n': u.createdDate
            }));
            
            const csv = 'data:text/csv;charset=utf-8,' + 
                Object.keys(data[0]).join(',') + '\n' +
                data.map(row => Object.values(row).join(',')).join('\n');
            
            const link = document.createElement('a');
            link.setAttribute('href', encodeURI(csv));
            link.setAttribute('download', 'powertools_usuarios.csv');
            link.click();
        }

        // === SISTEMA DE INVENTARIO ===
        
        function initializeInventory() {
            const savedProducts = localStorage.getItem('powertools_products');
            if (savedProducts) {
                products = JSON.parse(savedProducts);
            }
            updateInventoryDisplay();
        }
        
        function updateInventoryDisplay() {
            updateInventoryTable();
            updateInventoryGrid();
        }
        
        function updateInventoryTable() {
            const tbody = document.getElementById('inventoryTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                const stockStatus = getStockStatus(product.stock, product.minStock);
                const profit = ((product.sellPrice - product.buyPrice) / product.buyPrice * 100).toFixed(1);
                
                row.innerHTML = `
                    <td>
                        ${product.photo ? 
                            `<img src="${product.photo}" alt="${product.name}" class="product-thumb" onclick="viewProductDetails(${product.id})">` :
                            `<div class="no-thumb" onclick="viewProductDetails(${product.id})"><i class="fas fa-image"></i></div>`
                        }
                    </td>
                    <td><strong>${product.code}</strong></td>
                    <td>
                        <div><strong><a href="#" onclick="viewProductDetails(${product.id})" class="product-link">${product.name}</a></strong></div>
                        <small class="text-muted">${product.brand || 'Sin marca'}</small>
                    </td>
                    <td><span class="badge badge-${getCategoryColor(product.category)}">${product.category}</span></td>
                    <td>
                        <span class="stock-badge stock-${stockStatus.class}">${product.stock}</span>
                        ${product.stock <= product.minStock ? '<i class="fas fa-exclamation-triangle text-danger"></i>' : ''}
                    </td>
                    <td class="buy-price">$${product.buyPrice.toFixed(2)}</td>
                    <td class="sell-price">$${product.sellPrice.toFixed(2)} <small>(+${profit}%)</small></td>
                    <td><span class="badge badge-${stockStatus.class}">${stockStatus.text}</span></td>
                    <td>
                        <button class="btn btn-info" onclick="viewProductDetails(${product.id})" title="Ver Detalles">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-warning" onclick="editProduct(${product.id})" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-success" onclick="adjustStock(${product.id})" title="Ajustar Stock">
                            <i class="fas fa-boxes"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteProduct(${product.id})" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateInventoryGrid() {
            const grid = document.getElementById('gridView');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            products.forEach(product => {
                const stockStatus = getStockStatus(product.stock, product.minStock);
                const profit = ((product.sellPrice - product.buyPrice) / product.buyPrice * 100).toFixed(1);
                
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-image" onclick="viewProductDetails(${product.id})">
                        ${product.photo ? 
                            `<img src="${product.photo}" alt="${product.name}">` :
                            `<div class="no-image"><i class="fas fa-image"></i></div>`
                        }
                    </div>
                    <div class="product-info">
                        <div class="product-code">${product.code}</div>
                        <h4><a href="#" onclick="viewProductDetails(${product.id})" class="product-link">${product.name}</a></h4>
                        <p class="text-muted">${product.brand || 'Sin marca'} ‚Ä¢ ${product.category}</p>
                        <div class="product-prices">
                            <div class="buy-price">Compra: $${product.buyPrice.toFixed(2)}</div>
                            <div class="sell-price">Venta: $${product.sellPrice.toFixed(2)}</div>
                        </div>
                        <div class="stock-info">
                            <span class="stock-badge stock-${stockStatus.class}">Stock: ${product.stock}</span>
                            ${product.stock <= product.minStock ? '<i class="fas fa-exclamation-triangle text-danger"></i>' : ''}
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-info" onclick="viewProductDetails(${product.id})">
                                <i class="fas fa-eye"></i> Ver
                            </button>
                            <button class="btn btn-warning" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-success" onclick="adjustStock(${product.id})">
                                <i class="fas fa-boxes"></i> Stock
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        function saveProduct(event) {
            event.preventDefault();
            
            const productData = {
                code: document.getElementById('productCode').value.trim(),
                name: document.getElementById('productName').value.trim(),
                description: document.getElementById('productDescription').value.trim(),
                category: document.getElementById('productCategory').value,
                brand: document.getElementById('productBrand').value.trim(),
                stock: parseInt(document.getElementById('productStock').value),
                minStock: parseInt(document.getElementById('productMinStock').value),
                buyPrice: parseFloat(document.getElementById('productBuyPrice').value),
                sellPrice: parseFloat(document.getElementById('productSellPrice').value),
                photo: document.getElementById('photoPreview').src || null,
                notes: document.getElementById('productNotes').value.trim()
            };
            
            // Validar que el c√≥digo no exista (excepto si estamos editando)
            const existingProduct = products.find(p => p.code === productData.code && p.id !== editingProductId);
            if (existingProduct) {
                showAlert('El c√≥digo del producto ya existe', 'error');
                return;
            }
            
            if (editingProductId) {
                // Editar producto existente
                const productIndex = products.findIndex(p => p.id === editingProductId);
                if (productIndex !== -1) {
                    products[productIndex] = {
                        ...products[productIndex],
                        ...productData,
                        lastUpdated: new Date().toLocaleDateString('es-DO')
                    };
                    showAlert('Producto actualizado exitosamente', 'success');
                }
            } else {
                // Crear nuevo producto
                const newProduct = {
                    id: products.length + 1,
                    ...productData,
                    createdDate: new Date().toLocaleDateString('es-DO'),
                    lastUpdated: new Date().toLocaleDateString('es-DO')
                };
                products.push(newProduct);
                showAlert('Producto agregado exitosamente', 'success');
            }
            
            // Guardar en localStorage
            localStorage.setItem('powertools_products', JSON.stringify(products));
            
            // Actualizar display y cerrar modal
            updateInventoryDisplay();
            closeModal('productModal');
            clearProductForm();
        }
        
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            editingProductId = productId;
            
            // Llenar formulario
            document.getElementById('productCode').value = product.code;
            document.getElementById('productName').value = product.name;
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productBrand').value = product.brand || '';
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productMinStock').value = product.minStock;
            document.getElementById('productBuyPrice').value = product.buyPrice;
            document.getElementById('productSellPrice').value = product.sellPrice;
            document.getElementById('productNotes').value = product.notes || '';
            
            // Mostrar foto si existe
            if (product.photo) {
                document.getElementById('photoPreview').src = product.photo;
                document.getElementById('photoPreview').style.display = 'block';
                document.getElementById('photoPlaceholder').style.display = 'none';
                document.getElementById('photoActions').style.display = 'block';
            }
            
            // Cambiar t√≠tulos
            document.getElementById('productModalTitle').textContent = 'Editar Producto';
            document.getElementById('saveButtonText').textContent = 'Actualizar Producto';
            
            showModal('productModal');
        }
        
        function deleteProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            if (confirm(`¬øEst√°s seguro que deseas eliminar "${product.name}"?`)) {
                products = products.filter(p => p.id !== productId);
                localStorage.setItem('powertools_products', JSON.stringify(products));
                updateInventoryDisplay();
                showAlert('Producto eliminado exitosamente', 'success');
            }
        }
        
        function adjustStock(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const newStock = prompt(`Stock actual de "${product.name}": ${product.stock}\n\nIngresa el nuevo stock:`, product.stock);
            
            if (newStock !== null && !isNaN(newStock) && newStock >= 0) {
                product.stock = parseInt(newStock);
                product.lastUpdated = new Date().toLocaleDateString('es-DO');
                localStorage.setItem('powertools_products', JSON.stringify(products));
                updateInventoryDisplay();
                showAlert('Stock actualizado exitosamente', 'success');
            }
        }
        
        function clearProductForm() {
            editingProductId = null;
            document.getElementById('productCode').value = '';
            document.getElementById('productName').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productBrand').value = '';
            document.getElementById('productStock').value = '0';
            document.getElementById('productMinStock').value = '5';
            document.getElementById('productBuyPrice').value = '';
            document.getElementById('productSellPrice').value = '';
            document.getElementById('productNotes').value = '';
            
            // Resetear foto
            removeProductPhoto();
            
            // Resetear t√≠tulos
            document.getElementById('productModalTitle').textContent = 'Agregar Producto';
            document.getElementById('saveButtonText').textContent = 'Guardar Producto';
        }
        
        // Funciones de foto
        function previewProductPhoto() {
            const fileInput = document.getElementById('productPhoto');
            const preview = document.getElementById('photoPreview');
            const placeholder = document.getElementById('photoPlaceholder');
            const actions = document.getElementById('photoActions');
            
            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];
                
                // Validar tama√±o (5MB m√°ximo)
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('La imagen es demasiado grande. M√°ximo 5MB.', 'error');
                    return;
                }
                
                // Validar tipo
                if (!file.type.startsWith('image/')) {
                    showAlert('Por favor selecciona una imagen v√°lida.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    placeholder.style.display = 'none';
                    actions.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
        
        function removeProductPhoto() {
            document.getElementById('productPhoto').value = '';
            document.getElementById('photoPreview').src = '';
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('photoPlaceholder').style.display = 'block';
            document.getElementById('photoActions').style.display = 'none';
        }
        
        // Funciones auxiliares
        function getStockStatus(stock, minStock) {
            if (stock === 0) return { class: 'out', text: 'Agotado' };
            if (stock <= minStock) return { class: 'low', text: 'Stock Bajo' };
            if (stock <= minStock * 2) return { class: 'medium', text: 'Stock Medio' };
            return { class: 'high', text: 'Stock Alto' };
        }
        
        function getCategoryColor(category) {
            const colors = {
                'Herramientas El√©ctricas': 'primary',
                'Herramientas Manuales': 'secondary',
                'Construcci√≥n': 'warning',
                'Jardiner√≠a': 'success',
                'Automotriz': 'info',
                'Accesorios': 'light'
            };
            return colors[category] || 'secondary';
        }
        
        function filterProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const stockFilter = document.getElementById('stockFilter').value;
            
            // Aqu√≠ implementar√≠as la l√≥gica de filtrado
            // Por ahora solo actualizamos la vista
            updateInventoryDisplay();
        }
        
        function toggleView(viewType) {
            const gridView = document.getElementById('gridView');
            const tableView = document.getElementById('tableView');
            const gridBtn = document.getElementById('gridViewBtn');
            const tableBtn = document.getElementById('tableViewBtn');
            
            if (viewType === 'grid') {
                gridView.style.display = 'block';
                tableView.style.display = 'none';
                gridBtn.classList.add('active');
                tableBtn.classList.remove('active');
            } else {
                gridView.style.display = 'none';
                tableView.style.display = 'block';
                tableBtn.classList.add('active');
                gridBtn.classList.remove('active');
            }
        }
        
        function showLowStockAlert() {
            const lowStockProducts = products.filter(p => p.stock <= p.minStock);
            
            if (lowStockProducts.length === 0) {
                showAlert('¬°Excelente! No hay productos con stock bajo.', 'success');
                return;
            }
            
            let message = `‚ö†Ô∏è ALERTA DE STOCK BAJO:\n\n`;
            lowStockProducts.forEach(product => {
                message += `‚Ä¢ ${product.name} (${product.code}): ${product.stock} unidades\n`;
            });
            message += `\nTotal de productos afectados: ${lowStockProducts.length}`;
            
            alert(message);
        }
        
        function generateInventoryReport() {
            const totalProducts = products.length;
            const totalValue = products.reduce((sum, p) => sum + (p.stock * p.sellPrice), 0);
            const lowStockCount = products.filter(p => p.stock <= p.minStock).length;
            
            // An√°lisis por categor√≠as
            const categoryAnalysis = {};
            products.forEach(p => {
                if (!categoryAnalysis[p.category]) {
                    categoryAnalysis[p.category] = { count: 0, value: 0 };
                }
                categoryAnalysis[p.category].count++;
                categoryAnalysis[p.category].value += p.stock * p.sellPrice;
            });
            
            let categoryReport = '\nüìä AN√ÅLISIS POR CATEGOR√çAS:\n';
            Object.entries(categoryAnalysis).forEach(([category, data]) => {
                categoryReport += `‚Ä¢ ${category}: ${data.count} productos ($${data.value.toFixed(2)})\n`;
            });
            
            showAlert(`üìä REPORTE COMPLETO DE INVENTARIO:

üì¶ Total de productos: ${totalProducts}
üí∞ Valor total del inventario: $${totalValue.toFixed(2)}
‚ö†Ô∏è Productos con stock bajo: ${lowStockCount}
üìÖ √öltima actualizaci√≥n: ${new Date().toLocaleString('es-DO')}
${categoryReport}
üîÑ Rotaci√≥n promedio: Calculando...
üìà Productos m√°s vendidos: Pr√≥ximamente`, 'info');
        }

        // === FUNCIONES MEJORADAS DEL INVENTARIO ===
        
        function quickAddProduct() {
            const productData = {
                name: prompt('üè∑Ô∏è Nombre del producto:'),
                code: prompt('üî¢ C√≥digo del producto:'),
                category: prompt('üìÇ Categor√≠a:'),
                buyPrice: parseFloat(prompt('üí≤ Precio de compra:') || 0),
                sellPrice: parseFloat(prompt('üí∞ Precio de venta:') || 0),
                stock: parseInt(prompt('üì¶ Cantidad en stock:') || 0),
                minStock: parseInt(prompt('‚ö†Ô∏è Stock m√≠nimo:') || 5)
            };
            
            if (productData.name && productData.code) {
                // Simular agregar producto
                showAlert(`‚úÖ Producto "${productData.name}" agregado exitosamente`, 'success');
                updateInventoryDisplay();
            }
        }
        
        function duplicateProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const newName = prompt(`üìã Duplicar "${product.name}"\n\nNuevo nombre:`, product.name + ' (Copia)');
                if (newName) {
                    showAlert(`‚úÖ Producto duplicado: "${newName}"`, 'success');
                    updateInventoryDisplay();
                }
            }
        }
        
        function checkInventoryAlerts() {
            const alerts = [];
            
            // Stock bajo
            const lowStock = products.filter(p => p.stock <= p.minStock);
            if (lowStock.length > 0) {
                alerts.push(`‚ö†Ô∏è ${lowStock.length} productos con stock bajo`);
            }
            
            // Productos sin stock
            const outOfStock = products.filter(p => p.stock === 0);
            if (outOfStock.length > 0) {
                alerts.push(`üö´ ${outOfStock.length} productos agotados`);
            }
            
            // Productos sin precio
            const noPrice = products.filter(p => p.sellPrice === 0);
            if (noPrice.length > 0) {
                alerts.push(`üí≤ ${noPrice.length} productos sin precio`);
            }
            
            return alerts;
        }
        
        function showInventoryDashboard() {
            const alerts = checkInventoryAlerts();
            const totalValue = products.reduce((sum, p) => sum + (p.stock * p.sellPrice), 0);
            const averageMargin = products.length > 0 ? 
                products.reduce((sum, p) => sum + ((p.sellPrice - p.buyPrice) / p.buyPrice * 100), 0) / products.length : 0;
            
            let dashboardInfo = `üìä DASHBOARD DE INVENTARIO\n\n`;
            dashboardInfo += `üí∞ Valor total: $${totalValue.toFixed(2)}\n`;
            dashboardInfo += `üìà Margen promedio: ${averageMargin.toFixed(1)}%\n`;
            dashboardInfo += `üì¶ Total productos: ${products.length}\n\n`;
            
            if (alerts.length > 0) {
                dashboardInfo += `üö® ALERTAS:\n${alerts.join('\n')}\n\n`;
            } else {
                dashboardInfo += `‚úÖ Sin alertas - Todo en orden\n\n`;
            }
            
            dashboardInfo += `üîÑ √öltima actualizaci√≥n: ${new Date().toLocaleString('es-DO')}`;
            
            showAlert(dashboardInfo, alerts.length > 0 ? 'warning' : 'info');
        }
        
        function searchProductAdvanced() {
            const criteria = prompt(`üîç B√öSQUEDA AVANZADA\n\nOpciones de b√∫squeda:\n1. Por c√≥digo de barras\n2. Por rango de precios\n3. Por margen de ganancia\n4. Por √∫ltima actualizaci√≥n\n5. Por proveedor\n\nSelecciona una opci√≥n (1-5):`);
            
            switch(criteria) {
                case '1':
                    const barcode = prompt('Ingresa el c√≥digo de barras:');
                    if (barcode) {
                        document.getElementById('productSearch').value = barcode;
                        filterProducts();
                    }
                    break;
                case '2':
                    const minPrice = prompt('Precio m√≠nimo:');
                    const maxPrice = prompt('Precio m√°ximo:');
                    if (minPrice && maxPrice) {
                        showAlert(`üîç Buscando productos entre $${minPrice} y $${maxPrice}`, 'info');
                    }
                    break;
                case '3':
                    const minMargin = prompt('Margen m√≠nimo (%):', '20');
                    if (minMargin) {
                        showAlert(`üìà Buscando productos con margen >= ${minMargin}%`, 'info');
                    }
                    break;
                default:
                    if (criteria) showAlert('‚ùå Opci√≥n no v√°lida', 'error');
            }
        }
        
        function updateInventoryStats() {
            // Esta funci√≥n actualizar√≠a las estad√≠sticas en tiempo real
            const statsContainer = document.querySelector('.stats-grid');
            if (statsContainer) {
                // Aqu√≠ se actualizar√≠an las tarjetas de estad√≠sticas
                console.log('üìä Actualizando estad√≠sticas del inventario...');
            }
        }

        // === VISTA DETALLADA DE PRODUCTOS ===
        
        let currentDetailProductId = null;
        
        function viewProductDetails(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            currentDetailProductId = productId;
            
            // Calcular valores
            const profit = product.sellPrice - product.buyPrice;
            const margin = product.buyPrice > 0 ? ((profit / product.buyPrice) * 100).toFixed(1) : 0;
            const totalBuyValue = product.stock * product.buyPrice;
            const totalSellValue = product.stock * product.sellPrice;
            const potentialProfit = totalSellValue - totalBuyValue;
            
            // Llenar informaci√≥n b√°sica
            document.getElementById('detailsName').textContent = product.name;
            document.getElementById('detailsCode').textContent = product.code;
            document.getElementById('detailsBrand').textContent = product.brand || 'Sin marca';
            document.getElementById('detailsCategory').textContent = product.category;
            
            // Stock
            const stockStatus = getStockStatus(product.stock, product.minStock);
            const stockElement = document.getElementById('detailsStock');
            stockElement.textContent = product.stock;
            stockElement.className = `stock-large stock-${stockStatus.class}`;
            document.getElementById('detailsMinStock').textContent = product.minStock;
            
            // Precios
            document.getElementById('detailsBuyPrice').textContent = `$${product.buyPrice.toFixed(2)}`;
            document.getElementById('detailsSellPrice').textContent = `$${product.sellPrice.toFixed(2)}`;
            document.getElementById('detailsProfit').textContent = `$${profit.toFixed(2)}`;
            document.getElementById('detailsMargin').textContent = `${margin}%`;
            
            // Valores de inventario
            document.getElementById('detailsTotalBuyValue').textContent = `$${totalBuyValue.toFixed(2)}`;
            document.getElementById('detailsTotalSellValue').textContent = `$${totalSellValue.toFixed(2)}`;
            document.getElementById('detailsPotentialProfit').textContent = `$${potentialProfit.toFixed(2)}`;
            
            // Descripci√≥n y notas
            const descElement = document.getElementById('detailsDescription');
            descElement.textContent = product.description || 'Sin descripci√≥n disponible';
            
            const notesElement = document.getElementById('detailsNotes');
            notesElement.textContent = product.notes || 'Sin notas adicionales';
            
            // Historial
            document.getElementById('detailsCreatedDate').textContent = product.createdDate || '-';
            document.getElementById('detailsLastUpdated').textContent = product.lastUpdated || '-';
            
            // Imagen
            const imageElement = document.getElementById('detailsImage');
            const noImageElement = document.getElementById('detailsNoImage');
            
            if (product.photo) {
                imageElement.src = product.photo;
                imageElement.style.display = 'block';
                noImageElement.style.display = 'none';
            } else {
                imageElement.style.display = 'none';
                noImageElement.style.display = 'block';
            }
            
            // Mostrar modal
            showModal('productDetailsModal');
        }
        
        function editProductFromDetails() {
            closeModal('productDetailsModal');
            editProduct(currentDetailProductId);
        }
        
        function adjustStockFromDetails() {
            adjustStock(currentDetailProductId);
            // Actualizar la vista de detalles con los nuevos valores
            setTimeout(() => {
                if (document.getElementById('productDetailsModal').classList.contains('active')) {
                    viewProductDetails(currentDetailProductId);
                }
            }, 100);
        }
        
        function duplicateProduct() {
            const product = products.find(p => p.id === currentDetailProductId);
            if (!product) return;
            
            if (confirm(`¬øDeseas crear una copia de "${product.name}"?`)) {
                // Cerrar modal de detalles
                closeModal('productDetailsModal');
                
                // Llenar formulario con datos del producto (sin foto)
                document.getElementById('productCode').value = `${product.code}-COPY`;
                document.getElementById('productName').value = `${product.name} (Copia)`;
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productBrand').value = product.brand || '';
                document.getElementById('productStock').value = '0';
                document.getElementById('productMinStock').value = product.minStock;
                document.getElementById('productBuyPrice').value = product.buyPrice;
                document.getElementById('productSellPrice').value = product.sellPrice;
                document.getElementById('productNotes').value = product.notes || '';
                
                // Limpiar foto
                removeProductPhoto();
                
                // Mostrar modal de producto
                showModal('productModal');
            }
        }
        
        function updateUsersTable() {
            const tbody = document.querySelector('#usersTable tbody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td><span class="badge badge-success">Activo</span></td>
                    <td>${user.lastAccess}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editUser(${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${user.id !== currentUser.id ? `
                        <button class="btn btn-danger" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Navegaci√≥n
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
            
            // Cambiar icono del FAB seg√∫n la secci√≥n
            updateFabIcon(sectionName);
        }
        
        function updateFabIcon(sectionName) {
            const fab = document.getElementById('contextualFab');
            const fabIcon = fab.querySelector('i');
            
            const sectionIcons = {
                'dashboard': 'fas fa-chart-line',
                'inventory': 'fas fa-box',
                'quotations': 'fas fa-file-invoice',
                'expenses': 'fas fa-money-bill-wave',
                'sales': 'fas fa-shopping-cart',
                'users': 'fas fa-user-plus'
            };
            
            fabIcon.className = sectionIcons[sectionName] || 'fas fa-plus';
        }

        // Modales
        function showModal(modalId) {
            // Limpiar formulario de producto al abrir modal
            if (modalId === 'productModal' && !editingProductId) {
                clearProductForm();
            }
            
            // Inicializar modal de nueva cotizaci√≥n
            if (modalId === 'quotationModal' && !editingQuotationId) {
                initializeNewQuotationModal();
            }
            
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Usuarios
        function saveUser(event) {
            event.preventDefault();
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;
            const role = document.getElementById('userRole').value;
            
            users.push({
                id: users.length + 1,
                name: name,
                email: email,
                role: role,
                status: 'active',
                lastAccess: new Date().toLocaleString()
            });
            
            showAlert('Usuario creado exitosamente', 'success');
            closeModal('userModal');
            event.target.reset();
        }

        function editUser(id) {
            showAlert('Funci√≥n de edici√≥n disponible en versi√≥n completa', 'warning');
        }

        function deleteUser(id) {
            if (confirm('¬øEst√° seguro de eliminar este usuario?')) {
                showAlert('Usuario eliminado exitosamente', 'success');
            }
        }

        // Cotizaciones
        function approveQuotation(id) {
            showAlert('Cotizaci√≥n aprobada exitosamente', 'success');
        }

        function editQuotation(id) {
            showAlert('Editor de cotizaciones disponible', 'info');
        }

        function shareQuotation(id) {
            showAlert('Cotizaci√≥n compartida por email', 'success');
        }

        // Productos
        function editProduct(id) {
            showAlert('Editor de productos disponible', 'info');
        }

        function addStock(id) {
            const quantity = prompt('Cantidad a agregar al stock:');
            if (quantity) {
                showAlert(`Stock actualizado: +${quantity} unidades`, 'success');
            }
        }

        // Gastos
        function editExpense(id) {
            showAlert('Editor de gastos disponible', 'info');
        }

        function deleteExpense(id) {
            if (confirm('¬øEliminar este gasto?')) {
                showAlert('Gasto eliminado exitosamente', 'success');
            }
        }

        // Ventas
        function printInvoice(id) {
            showAlert('Imprimiendo factura...', 'info');
            setTimeout(() => window.print(), 1000);
        }

        function sendInvoice(id) {
            showAlert('Factura enviada por email', 'success');
        }

        // Reportes
        function generateReport(type) {
            showAlert(`Generando reporte ${type}...`, 'info');
        }

        function exportData() {
            showAlert('Exportando datos a Excel...', 'info');
        }

        function exportUsers() {
            showAlert('Lista de usuarios exportada', 'success');
        }

        function exportQuotations() {
            showAlert('Cotizaciones exportadas a PDF', 'success');
        }

        // === SISTEMA COMPLETO DE COTIZACIONES ===
        
        let quotations = [];
        let editingQuotationId = null;
        let quotationCounter = 1;
        let selectedProducts = [];

        // Inicializar cotizaciones
        function initializeQuotations() {
            // Cargar cotizaciones guardadas
            const savedQuotations = localStorage.getItem('powertools_quotations');
            if (savedQuotations) {
                quotations = JSON.parse(savedQuotations);
                quotationCounter = quotations.length > 0 ? Math.max(...quotations.map(q => parseInt(q.number.split('-')[1]))) + 1 : 1;
            }
            
            // Agregar datos de ejemplo si no hay cotizaciones
            if (quotations.length === 0) {
                quotations = [
                    {
                        id: 1,
                        number: 'COT-001',
                        clientName: 'Constructora ABC',
                        clientEmail: 'info@constructoraabc.com',
                        clientPhone: '809-555-0101',
                        clientCompany: 'Constructora ABC S.R.L.',
                        clientAddress: 'Av. 27 de Febrero #123, Santo Domingo',
                        date: '2025-08-08',
                        validUntil: '2025-08-23',
                        paymentTerms: '15dias',
                        notes: 'Incluye instalaci√≥n y garant√≠a de 1 a√±o',
                        products: [
                            { id: 1, name: 'Taladro Dewalt 20V', code: 'DW001', quantity: 2, unitPrice: 250.00, discount: 0 },
                            { id: 2, name: 'Set de Brocas', code: 'BR001', quantity: 3, unitPrice: 35.00, discount: 5 }
                        ],
                        subtotal: 605.00,
                        discount: 5.25,
                        tax: 107.96,
                        total: 707.71,
                        status: 'pending',
                        createdAt: new Date('2025-08-08').toISOString(),
                        updatedAt: new Date('2025-08-08').toISOString()
                    }
                ];
                saveQuotationsToStorage();
            }
            
            updateQuotationsDisplay();
        }

        // Guardar cotizaciones en localStorage
        function saveQuotationsToStorage() {
            localStorage.setItem('powertools_quotations', JSON.stringify(quotations));
        }

        // Generar n√∫mero de cotizaci√≥n autom√°tico
        function generateQuotationNumber() {
            return `COT-${String(quotationCounter).padStart(3, '0')}`;
        }

        // Abrir modal de nueva cotizaci√≥n
        function openNewQuotation() {
            editingQuotationId = null;
            selectedProducts = [];
            initializeNewQuotationModal();
            showModal('quotationModal');
        }

        // Inicializar modal de nueva cotizaci√≥n (sin llamar showModal)
        function initializeNewQuotationModal() {
            document.getElementById('quotationModalTitle').textContent = 'Nueva Cotizaci√≥n';
            document.getElementById('saveQuotationButtonText').textContent = 'Guardar Cotizaci√≥n';
            
            // Limpiar formulario
            clearQuotationForm();
            
            // Generar n√∫mero autom√°tico
            document.getElementById('quotationNumber').value = generateQuotationNumber();
            
            // Fecha actual
            document.getElementById('quotationDate').value = new Date().toISOString().split('T')[0];
            
            // Fecha v√°lida hasta (15 d√≠as por defecto)
            const validUntil = new Date();
            validUntil.setDate(validUntil.getDate() + 15);
            document.getElementById('validUntil').value = validUntil.toISOString().split('T')[0];
            
            updateQuotationProductsDisplay();
            calculateQuotationTotals();
        }

        // Limpiar formulario de cotizaci√≥n
        function clearQuotationForm() {
            document.getElementById('quotationForm').reset();
            selectedProducts = [];
            updateQuotationProductsDisplay();
            calculateQuotationTotals();
        }

        // Buscar productos para cotizaci√≥n
        function searchProductsForQuotation() {
            const searchTerm = document.getElementById('productSearchQuotation').value.toLowerCase();
            const resultsContainer = document.getElementById('productSearchResults');
            
            if (searchTerm.length < 2) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            // Filtrar productos del inventario
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm) ||
                product.code.toLowerCase().includes(searchTerm) ||
                product.category.toLowerCase().includes(searchTerm)
            );
            
            if (filteredProducts.length === 0) {
                resultsContainer.innerHTML = '<div class="product-search-item"><div class="product-info">No se encontraron productos</div></div>';
                resultsContainer.style.display = 'block';
                return;
            }
            
            // Mostrar resultados
            resultsContainer.innerHTML = filteredProducts.map(product => `
                <div class="product-search-item" onclick="addProductToQuotation(${product.id})">
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-details">${product.code} - ${product.category}</div>
                    </div>
                    <div class="product-price">$${product.sellPrice.toFixed(2)}</div>
                </div>
            `).join('');
            
            resultsContainer.style.display = 'block';
        }

        // Agregar producto a la cotizaci√≥n
        function addProductToQuotation(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Verificar si ya est√° agregado
            const existingProduct = selectedProducts.find(p => p.id === productId);
            if (existingProduct) {
                existingProduct.quantity += 1;
            } else {
                selectedProducts.push({
                    id: product.id,
                    name: product.name,
                    code: product.code,
                    quantity: 1,
                    unitPrice: product.sellPrice,
                    discount: 0
                });
            }
            
            // Limpiar b√∫squeda
            document.getElementById('productSearchQuotation').value = '';
            document.getElementById('productSearchResults').style.display = 'none';
            
            updateQuotationProductsDisplay();
            calculateQuotationTotals();
        }

        // Actualizar display de productos en cotizaci√≥n
        function updateQuotationProductsDisplay() {
            const tbody = document.getElementById('quotationProductsBody');
            const emptyMessage = document.getElementById('emptyProducts');
            
            if (selectedProducts.length === 0) {
                tbody.innerHTML = '';
                emptyMessage.style.display = 'block';
                return;
            }
            
            emptyMessage.style.display = 'none';
            
            tbody.innerHTML = selectedProducts.map((product, index) => `
                <tr>
                    <td>${product.name}</td>
                    <td>${product.code}</td>
                    <td>
                        <input type="number" class="quantity-input" value="${product.quantity}" 
                               min="1" onchange="updateProductQuantity(${index}, this.value)">
                    </td>
                    <td>$${product.unitPrice.toFixed(2)}</td>
                    <td>
                        <input type="number" class="discount-input" value="${product.discount}" 
                               min="0" max="100" onchange="updateProductDiscount(${index}, this.value)">%
                    </td>
                    <td>$${calculateLineTotal(product).toFixed(2)}</td>
                    <td>
                        <button type="button" class="btn btn-danger" onclick="removeProductFromQuotation(${index})" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Calcular total de l√≠nea
        function calculateLineTotal(product) {
            const subtotal = product.quantity * product.unitPrice;
            const discountAmount = subtotal * (product.discount / 100);
            return subtotal - discountAmount;
        }

        // Actualizar cantidad de producto
        function updateProductQuantity(index, newQuantity) {
            if (newQuantity < 1) return;
            selectedProducts[index].quantity = parseInt(newQuantity);
            updateQuotationProductsDisplay();
            calculateQuotationTotals();
        }

        // Actualizar descuento de producto
        function updateProductDiscount(index, newDiscount) {
            if (newDiscount < 0 || newDiscount > 100) return;
            selectedProducts[index].discount = parseFloat(newDiscount) || 0;
            updateQuotationProductsDisplay();
            calculateQuotationTotals();
        }

        // Eliminar producto de cotizaci√≥n
        function removeProductFromQuotation(index) {
            selectedProducts.splice(index, 1);
            updateQuotationProductsDisplay();
            calculateQuotationTotals();
        }

        // Calcular totales de cotizaci√≥n
        function calculateQuotationTotals() {
            let subtotal = 0;
            let totalDiscount = 0;
            
            selectedProducts.forEach(product => {
                const lineSubtotal = product.quantity * product.unitPrice;
                const lineDiscount = lineSubtotal * (product.discount / 100);
                subtotal += lineSubtotal;
                totalDiscount += lineDiscount;
            });
            
            const afterDiscount = subtotal - totalDiscount;
            const includeTax = document.getElementById('includeTax').checked;
            const tax = includeTax ? afterDiscount * 0.18 : 0;
            const total = afterDiscount + tax;
            
            document.getElementById('quotationSubtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('quotationDiscount').textContent = `$${totalDiscount.toFixed(2)}`;
            document.getElementById('quotationTax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('quotationTotal').textContent = `$${total.toFixed(2)}`;
        }

        // Guardar cotizaci√≥n
        function saveQuotation(event) {
            event.preventDefault();
            
            if (selectedProducts.length === 0) {
                showAlert('‚ùå Debe agregar al menos un producto a la cotizaci√≥n', 'error');
                return;
            }
            
            const quotationData = {
                clientName: document.getElementById('clientName').value,
                clientEmail: document.getElementById('clientEmail').value,
                clientPhone: document.getElementById('clientPhone').value,
                clientCompany: document.getElementById('clientCompany').value,
                clientAddress: document.getElementById('clientAddress').value,
                date: document.getElementById('quotationDate').value,
                validUntil: document.getElementById('validUntil').value,
                paymentTerms: document.getElementById('paymentTerms').value,
                notes: document.getElementById('quotationNotes').value,
                products: [...selectedProducts],
                includeTax: document.getElementById('includeTax').checked
            };
            
            // Calcular totales finales
            let subtotal = 0;
            let totalDiscount = 0;
            
            selectedProducts.forEach(product => {
                const lineSubtotal = product.quantity * product.unitPrice;
                const lineDiscount = lineSubtotal * (product.discount / 100);
                subtotal += lineSubtotal;
                totalDiscount += lineDiscount;
            });
            
            const afterDiscount = subtotal - totalDiscount;
            const tax = quotationData.includeTax ? afterDiscount * 0.18 : 0;
            const total = afterDiscount + tax;
            
            quotationData.subtotal = subtotal;
            quotationData.discount = totalDiscount;
            quotationData.tax = tax;
            quotationData.total = total;
            
            if (editingQuotationId) {
                // Editar cotizaci√≥n existente
                const index = quotations.findIndex(q => q.id === editingQuotationId);
                if (index !== -1) {
                    quotations[index] = {
                        ...quotations[index],
                        ...quotationData,
                        updatedAt: new Date().toISOString()
                    };
                    showAlert('‚úÖ Cotizaci√≥n actualizada exitosamente', 'success');
                }
            } else {
                // Nueva cotizaci√≥n
                const newQuotation = {
                    id: Date.now(),
                    number: document.getElementById('quotationNumber').value,
                    ...quotationData,
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                quotations.push(newQuotation);
                quotationCounter++;
                showAlert('‚úÖ Cotizaci√≥n creada exitosamente', 'success');
            }
            
            saveQuotationsToStorage();
            updateQuotationsDisplay();
            closeModal('quotationModal');
        }

        // Actualizar display de cotizaciones
        function updateQuotationsDisplay() {
            const tbody = document.getElementById('quotationsTableBody');
            const emptyMessage = document.getElementById('emptyQuotations');
            
            if (quotations.length === 0) {
                tbody.innerHTML = '';
                emptyMessage.style.display = 'block';
                return;
            }
            
            emptyMessage.style.display = 'none';
            
            tbody.innerHTML = quotations.map(quotation => {
                const statusInfo = getQuotationStatusInfo(quotation.status);
                const formattedDate = new Date(quotation.date).toLocaleDateString('es-DO');
                
                return `
                    <tr>
                        <td><strong>${quotation.number}</strong></td>
                        <td>
                            <div>${quotation.clientName}</div>
                            <div style="font-size: 0.8rem; color: #666;">${quotation.clientCompany || ''}</div>
                        </td>
                        <td>${formattedDate}</td>
                        <td><strong>$${quotation.total.toFixed(2)}</strong></td>
                        <td><span class="badge ${statusInfo.class}">${statusInfo.text}</span></td>
                        <td>
                            <button class="btn btn-success" onclick="approveQuotation(${quotation.id})" title="Aprobar">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-warning" onclick="editQuotation(${quotation.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn" onclick="shareQuotation(${quotation.id})" title="Compartir">
                                <i class="fas fa-share"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteQuotation(${quotation.id})" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Obtener informaci√≥n de estado
        function getQuotationStatusInfo(status) {
            const statusMap = {
                'pending': { text: 'Pendiente', class: 'quotation-status-pending' },
                'approved': { text: 'Aprobada', class: 'quotation-status-approved' },
                'rejected': { text: 'Rechazada', class: 'quotation-status-rejected' },
                'expired': { text: 'Expirada', class: 'quotation-status-expired' }
            };
            return statusMap[status] || { text: 'Desconocido', class: 'badge-secondary' };
        }

        // Eliminar cotizaci√≥n
        function deleteQuotation(quotationId) {
            const quotation = quotations.find(q => q.id === quotationId);
            if (!quotation) return;
            
            if (confirm(`¬øEst√°s seguro de eliminar la cotizaci√≥n ${quotation.number}?\n\nEsta acci√≥n no se puede deshacer.`)) {
                quotations = quotations.filter(q => q.id !== quotationId);
                saveQuotationsToStorage();
                updateQuotationsDisplay();
                showAlert('üóëÔ∏è Cotizaci√≥n eliminada exitosamente', 'success');
            }
        }

        // Vista previa de cotizaci√≥n
        function previewQuotation() {
            if (selectedProducts.length === 0) {
                showAlert('‚ùå Debe agregar productos para ver la vista previa', 'error');
                return;
            }
            
            // Aqu√≠ se abrir√≠a una ventana con la vista previa de la cotizaci√≥n
            showAlert('üëÅÔ∏è Abriendo vista previa de cotizaci√≥n...', 'info');
        }

        // Funciones adicionales
        function approveQuotation(quotationId) {
            const quotation = quotations.find(q => q.id === quotationId);
            if (quotation) {
                quotation.status = 'approved';
                quotation.updatedAt = new Date().toISOString();
                saveQuotationsToStorage();
                updateQuotationsDisplay();
                showAlert('‚úÖ Cotizaci√≥n aprobada', 'success');
            }
        }

        function editQuotation(quotationId) {
            const quotation = quotations.find(q => q.id === quotationId);
            if (!quotation) return;
            
            editingQuotationId = quotationId;
            selectedProducts = [...quotation.products];
            
            // Llenar formulario
            document.getElementById('quotationModalTitle').textContent = 'Editar Cotizaci√≥n';
            document.getElementById('saveQuotationButtonText').textContent = 'Actualizar Cotizaci√≥n';
            document.getElementById('clientName').value = quotation.clientName;
            document.getElementById('clientEmail').value = quotation.clientEmail || '';
            document.getElementById('clientPhone').value = quotation.clientPhone || '';
            document.getElementById('clientCompany').value = quotation.clientCompany || '';
            document.getElementById('clientAddress').value = quotation.clientAddress || '';
            document.getElementById('quotationNumber').value = quotation.number;
            document.getElementById('quotationDate').value = quotation.date;
            document.getElementById('validUntil').value = quotation.validUntil;
            document.getElementById('paymentTerms').value = quotation.paymentTerms;
            document.getElementById('quotationNotes').value = quotation.notes || '';
            document.getElementById('includeTax').checked = quotation.tax > 0;
            
            updateQuotationProductsDisplay();
            calculateQuotationTotals();
            showModal('quotationModal');
        }

        function shareQuotation(quotationId) {
            const quotation = quotations.find(q => q.id === quotationId);
            if (quotation) {
                // Simular compartir cotizaci√≥n
                showAlert(`üì§ Compartiendo cotizaci√≥n ${quotation.number} con ${quotation.clientName}`, 'info');
            }
        }

        // Ocultar resultados de b√∫squeda al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.product-search-container')) {
                document.getElementById('productSearchResults').style.display = 'none';
            }
        });

        function exportExpenses() {
            showAlert('Gastos exportados a Excel', 'success');
        }

        function generateInventoryReport() {
            showAlert('Reporte de inventario generado', 'success');
        }

        function generateSalesReport() {
            showAlert('Reporte de ventas generado', 'success');
        }

        function exportAllData() {
            try {
                // Recopilar todos los datos del localStorage
                const backupData = {
                    version: "1.0",
                    timestamp: new Date().toISOString(),
                    data: {
                        users: JSON.parse(localStorage.getItem('powertools_users') || '[]'),
                        credentials: JSON.parse(localStorage.getItem('powertools_credentials') || '[]'),
                        inventory: JSON.parse(localStorage.getItem('powertools_inventory') || '[]'),
                        quotations: JSON.parse(localStorage.getItem('powertools_quotations') || '[]'),
                        expenses: JSON.parse(localStorage.getItem('powertools_expenses') || '[]'),
                        sales: JSON.parse(localStorage.getItem('powertools_sales') || '[]'),
                        settings: JSON.parse(localStorage.getItem('powertools_settings') || '{}')
                    }
                };

                // Crear archivo de descarga
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                // Crear enlace de descarga
                const link = document.createElement('a');
                link.href = url;
                link.download = `powertools_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showAlert('‚úÖ Respaldo creado exitosamente! Archivo descargado.', 'success');
            } catch (error) {
                console.error('Error al crear respaldo:', error);
                showAlert('‚ùå Error al crear el respaldo. Intenta de nuevo.', 'error');
            }
        }

        function importAllData() {
            // Crear input file oculto
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        // Validar estructura del respaldo
                        if (!backupData.data || !backupData.version) {
                            throw new Error('Formato de respaldo inv√°lido');
                        }

                        // Confirmar restauraci√≥n
                        if (confirm('‚ö†Ô∏è ADVERTENCIA: Esto sobrescribir√° todos los datos actuales.\n\n¬øEst√°s seguro de que quieres restaurar el respaldo?\n\nFecha del respaldo: ' + new Date(backupData.timestamp).toLocaleString())) {
                            // Restaurar datos
                            const data = backupData.data;
                            
                            if (data.users) localStorage.setItem('powertools_users', JSON.stringify(data.users));
                            if (data.credentials) localStorage.setItem('powertools_credentials', JSON.stringify(data.credentials));
                            if (data.inventory) localStorage.setItem('powertools_inventory', JSON.stringify(data.inventory));
                            if (data.quotations) localStorage.setItem('powertools_quotations', JSON.stringify(data.quotations));
                            if (data.expenses) localStorage.setItem('powertools_expenses', JSON.stringify(data.expenses));
                            if (data.sales) localStorage.setItem('powertools_sales', JSON.stringify(data.sales));
                            if (data.settings) localStorage.setItem('powertools_settings', JSON.stringify(data.settings));
                            
                            showAlert('‚úÖ Datos restaurados exitosamente! Recargando p√°gina...', 'success');
                            
                            // Recargar p√°gina despu√©s de 2 segundos
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                        }
                    } catch (error) {
                        console.error('Error al restaurar respaldo:', error);
                        showAlert('‚ùå Error al leer el archivo de respaldo. Verifica que sea un archivo v√°lido.', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Funci√≥n para verificar integridad de datos antes del respaldo
        function verifyDataIntegrity() {
            const dataSummary = {
                users: JSON.parse(localStorage.getItem('powertools_users') || '[]').length,
                credentials: JSON.parse(localStorage.getItem('powertools_credentials') || '[]').length,
                inventory: JSON.parse(localStorage.getItem('powertools_inventory') || '[]').length,
                quotations: JSON.parse(localStorage.getItem('powertools_quotations') || '[]').length,
                expenses: JSON.parse(localStorage.getItem('powertools_expenses') || '[]').length,
                sales: JSON.parse(localStorage.getItem('powertools_sales') || '[]').length
            };

            const summary = `üìä RESUMEN DE DATOS A RESPALDAR:
            
üë• Usuarios: ${dataSummary.users}
üîê Credenciales: ${dataSummary.credentials}
üì¶ Productos en inventario: ${dataSummary.inventory}
üìã Cotizaciones: ${dataSummary.quotations}
üí∞ Gastos registrados: ${dataSummary.expenses}
üõí Ventas registradas: ${dataSummary.sales}

¬øDeseas continuar con el respaldo?`;

            return confirm(summary);
        }

        // Funci√≥n mejorada de respaldo con verificaci√≥n
        function createBackupWithVerification() {
            if (verifyDataIntegrity()) {
                exportAllData();
            }
        }

        // === FUNCIONES M√ìVILES ESPEC√çFICAS ===
        
        // B√∫squeda por voz
        let recognition = null;
        
        function startVoiceSearch() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showAlert('‚ùå Tu navegador no soporta b√∫squeda por voz', 'error');
                return;
            }
            
            try {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'es-ES';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                const voiceBtn = document.querySelector('.voice-search i');
                voiceBtn.classList.add('voice-active');
                
                recognition.onstart = () => {
                    showAlert('üé§ Escuchando... D√≠ el nombre del producto', 'info');
                };
                
                recognition.onresult = (event) => {
                    const searchTerm = event.results[0][0].transcript;
                    document.getElementById('productSearch').value = searchTerm;
                    filterProducts();
                    showAlert(`‚úÖ Buscando: "${searchTerm}"`, 'success');
                };
                
                recognition.onerror = (event) => {
                    showAlert('‚ùå Error en el reconocimiento de voz', 'error');
                };
                
                recognition.onend = () => {
                    voiceBtn.classList.remove('voice-active');
                };
                
                recognition.start();
            } catch (error) {
                showAlert('‚ùå Error al iniciar b√∫squeda por voz', 'error');
            }
        }
        
        // Esc√°ner de c√≥digos de barras (simulado)
        function startBarcodeScanner() {
            // En una implementaci√≥n real, esto usar√≠a la c√°mara del dispositivo
            // Por ahora simulamos el esc√°ner
            
            showAlert('üì∑ Iniciando esc√°ner...', 'info');
            
            // Simular escaneo despu√©s de 2 segundos
            setTimeout(() => {
                const mockBarcode = prompt('üîç Ingresa el c√≥digo de barras o c√≥digo del producto:');
                if (mockBarcode) {
                    document.getElementById('productSearch').value = mockBarcode;
                    filterProducts();
                    showAlert(`‚úÖ C√≥digo escaneado: ${mockBarcode}`, 'success');
                }
            }, 1000);
        }
        
        // Acciones en lote
        function bulkActions() {
            const actions = [
                '1. Actualizar precios',
                '2. Actualizar stock',
                '3. Cambiar categor√≠a',
                '4. Exportar seleccionados',
                '5. Eliminar seleccionados'
            ];
            
            const action = prompt('üìã ACCIONES EN LOTE:\n\n' + actions.join('\n') + '\n\nSelecciona una opci√≥n (1-5):');
            
            switch(action) {
                case '1':
                    bulkUpdatePrices();
                    break;
                case '2':
                    bulkUpdateStock();
                    break;
                case '3':
                    bulkChangeCategory();
                    break;
                case '4':
                    exportSelectedProducts();
                    break;
                case '5':
                    bulkDeleteProducts();
                    break;
                default:
                    if (action) showAlert('‚ùå Opci√≥n no v√°lida', 'error');
            }
        }
        
        function bulkUpdatePrices() {
            const percentage = prompt('üí∞ Actualizar precios:\n\nIngresa el porcentaje de ajuste\n(Ejemplo: 10 para +10%, -5 para -5%):');
            if (percentage && !isNaN(percentage)) {
                const change = parseFloat(percentage);
                showAlert(`‚úÖ Precios actualizados en ${change}%`, 'success');
            }
        }
        
        function bulkUpdateStock() {
            const operation = prompt('üì¶ Actualizar stock:\n\n1. Sumar cantidad\n2. Restar cantidad\n3. Establecer cantidad fija\n\nSelecciona una opci√≥n:');
            if (operation) {
                const amount = prompt('Ingresa la cantidad:');
                if (amount && !isNaN(amount)) {
                    showAlert(`‚úÖ Stock actualizado`, 'success');
                }
            }
        }
        
        function bulkChangeCategory() {
            const categories = ['Herramientas El√©ctricas', 'Herramientas Manuales', 'Construcci√≥n', 'Jardiner√≠a', 'Automotriz', 'Accesorios'];
            const categoryList = categories.map((cat, index) => `${index + 1}. ${cat}`).join('\n');
            const selection = prompt('üìÇ Cambiar categor√≠a:\n\n' + categoryList + '\n\nSelecciona una opci√≥n:');
            
            if (selection && selection >= 1 && selection <= categories.length) {
                showAlert(`‚úÖ Categor√≠a cambiada a: ${categories[selection - 1]}`, 'success');
            }
        }
        
        function exportSelectedProducts() {
            showAlert('üìÑ Exportando productos seleccionados...', 'info');
        }
        
        function bulkDeleteProducts() {
            if (confirm('‚ö†Ô∏è ¬øEst√°s seguro de eliminar los productos seleccionados?\n\nEsta acci√≥n no se puede deshacer.')) {
                showAlert('üóëÔ∏è Productos eliminados', 'success');
            }
        }
        
        // Gestos touch para navegaci√≥n r√°pida
        let touchStartX = 0;
        let touchStartY = 0;
        
        function initializeTouchGestures() {
            const container = document.querySelector('.container');
            
            container.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            });
            
            container.addEventListener('touchend', (e) => {
                if (!touchStartX || !touchStartY) return;
                
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                
                const deltaX = touchStartX - touchEndX;
                const deltaY = touchStartY - touchEndY;
                
                // Swipe horizontal para cambiar secciones
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                    if (deltaX > 0) {
                        // Swipe izquierda - siguiente secci√≥n
                        navigateSection('next');
                    } else {
                        // Swipe derecha - secci√≥n anterior
                        navigateSection('prev');
                    }
                }
                
                touchStartX = 0;
                touchStartY = 0;
            });
        }
        
        function navigateSection(direction) {
            const sections = ['dashboard', 'inventory', 'quotations', 'expenses', 'sales', 'users'];
            const currentSection = document.querySelector('.section.active').id;
            const currentIndex = sections.indexOf(currentSection);
            
            let nextIndex;
            if (direction === 'next') {
                nextIndex = (currentIndex + 1) % sections.length;
            } else {
                nextIndex = currentIndex === 0 ? sections.length - 1 : currentIndex - 1;
            }
            
            showSection(sections[nextIndex]);
        }
        
        // Optimizaci√≥n de rendimiento para m√≥viles
        function optimizeForMobile() {
            // Lazy loading de im√°genes
            const images = document.querySelectorAll('img[data-src]');
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.classList.remove('lazy');
                        imageObserver.unobserve(img);
                    }
                });
            });
            
            images.forEach(img => imageObserver.observe(img));
            
            // Inicializar gestos touch
            initializeTouchGestures();
        }
        
        // Acciones r√°pidas contextuales
        function showContextualActions() {
            const activeSection = document.querySelector('.section.active').id;
            
            switch(activeSection) {
                case 'inventory':
                    showInventoryActions();
                    break;
                case 'quotations':
                    showQuotationActions();
                    break;
                case 'sales':
                    showSalesActions();
                    break;
                case 'expenses':
                    showExpenseActions();
                    break;
                case 'users':
                    showUserActions();
                    break;
                default:
                    showQuickActions();
            }
        }
        
        function showInventoryActions() {
            const actions = [
                '1. üÜï Agregar producto r√°pido',
                '2. üìä Dashboard de inventario', 
                '3. üîç B√∫squeda avanzada',
                '4. üì± Escanear c√≥digo',
                '5. üé§ B√∫squeda por voz',
                '6. üìã Acciones en lote',
                '7. üìà Ver alertas'
            ];
            
            const action = prompt('üöÄ ACCIONES R√ÅPIDAS - INVENTARIO:\n\n' + actions.join('\n') + '\n\nSelecciona una opci√≥n (1-7):');
            
            switch(action) {
                case '1':
                    quickAddProduct();
                    break;
                case '2':
                    showInventoryDashboard();
                    break;
                case '3':
                    searchProductAdvanced();
                    break;
                case '4':
                    startBarcodeScanner();
                    break;
                case '5':
                    startVoiceSearch();
                    break;
                case '6':
                    bulkActions();
                    break;
                case '7':
                    const alerts = checkInventoryAlerts();
                    if (alerts.length > 0) {
                        showAlert('üö® ALERTAS ACTIVAS:\n\n' + alerts.join('\n'), 'warning');
                    } else {
                        showAlert('‚úÖ Sin alertas - Todo en orden', 'success');
                    }
                    break;
                default:
                    if (action) showAlert('‚ùå Opci√≥n no v√°lida', 'error');
            }
        }
        
        function showQuotationActions() {
            const actions = [
                '1. üìù Nueva cotizaci√≥n',
                '2. üìÑ Duplicar √∫ltima cotizaci√≥n',
                '3. üìä Ver estad√≠sticas'
            ];
            
            const action = prompt('üíº ACCIONES R√ÅPIDAS - COTIZACIONES:\n\n' + actions.join('\n') + '\n\nSelecciona una opci√≥n (1-3):');
            
            if (action === '1') {
                showModal('quotationModal');
            } else if (action === '2') {
                showAlert('üìÑ Duplicando √∫ltima cotizaci√≥n...', 'info');
            } else if (action === '3') {
                showAlert('üìä Cargando estad√≠sticas de cotizaciones...', 'info');
            }
        }
        
        function showSalesActions() {
            const actions = [
                '1. üõí Nueva venta',
                '2. üßæ Generar recibo',
                '3. üìà Ver ventas del d√≠a'
            ];
            
            const action = prompt('üí∞ ACCIONES R√ÅPIDAS - VENTAS:\n\n' + actions.join('\n') + '\n\nSelecciona una opci√≥n (1-3):');
            
            if (action === '1') {
                showModal('saleModal');
            } else if (action === '2') {
                showAlert('üßæ Preparando recibo...', 'info');
            } else if (action === '3') {
                showAlert('üìà Ventas de hoy: $450.00', 'success');
            }
        }
        
        function showExpenseActions() {
            const actions = [
                '1. üí∏ Nuevo gasto',
                '2. üì± Foto de recibo',
                '3. üìä Resumen mensual'
            ];
            
            const action = prompt('üí≥ ACCIONES R√ÅPIDAS - GASTOS:\n\n' + actions.join('\n') + '\n\nSelecciona una opci√≥n (1-3):');
            
            if (action === '1') {
                showModal('expenseModal');
            } else if (action === '2') {
                showAlert('üì± Funci√≥n de foto de recibo pr√≥ximamente...', 'info');
            } else if (action === '3') {
                showAlert('üìä Gastos del mes: $1,250.00', 'info');
            }
        }
        
        function showUserActions() {
            const actions = [
                '1. üë§ Nuevo usuario',
                '2. üíæ Respaldar datos',
                '3. üì§ Importar datos'
            ];
            
            const action = prompt('üë• ACCIONES R√ÅPIDAS - USUARIOS:\n\n' + actions.join('\n') + '\n\nSelecciona una opci√≥n (1-3):');
            
            if (action === '1') {
                showModal('userModal');
            } else if (action === '2') {
                createBackupWithVerification();
            } else if (action === '3') {
                importAllData();
            }
        }

        // Acciones r√°pidas
        function showQuickActions() {
            const actions = [
                'Nueva Venta',
                'Nueva Cotizaci√≥n', 
                'Agregar Producto',
                'Registrar Gasto'
            ];
            const action = prompt('Acci√≥n r√°pida:\n' + actions.map((a, i) => `${i+1}. ${a}`).join('\n'));
            if (action) {
                showAlert(`Ejecutando: ${actions[action-1]}`, 'info');
            }
        }

        // Sistema de alertas
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type === 'info' ? 'success' : type}`;
            alertDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i> ${message}`;
            
            document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.container').firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // Cerrar modales al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si hay usuario logueado
            checkExistingLogin();
            
            // Inicializar inventario
            initializeInventory();
            
            // Inicializar cotizaciones
            initializeQuotations();
            
            // Optimizaciones para m√≥viles
            optimizeForMobile();
            
            // Detectar si es dispositivo m√≥vil
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                document.body.classList.add('mobile-device');
                console.log('üì± Dispositivo m√≥vil detectado - Optimizaciones activadas');
            }
            
            // Si no hay usuario logueado, el sistema mostrar√° autom√°ticamente la pantalla de login
            if (!currentUser) {
                console.log('üîê Mostrando pantalla de login');
            } else {
                showAlert(`Bienvenido de nuevo, ${currentUser.name}`, 'success');
            }
            
            console.log('üîß PowerTools RD Sistema Completo v2.0 - Optimizado para m√≥viles');
        });
    </script>
</body>
</html>
